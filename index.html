<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>LÈVORE — Couture Chocolate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase Configuration - Replace with your actual credentials
    window.SUPABASE_URL = 'https://nmrvywjsscbepicifkci.supabase.co';
    window.SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5tcnZ5d2pzc2NiZXBpY2lma2NpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3OTMzNjYsImV4cCI6MjA3NzM2OTM2Nn0.ur1-JhtKEp2N9yPOCGtXhUMdnPpSY_BP2FTN0wJnPYQ';
  </script>
  <style>
    /* MOBILE FIX: Initial loader visible before React loads */
    #initial-loader {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 9999;
      font-family: system-ui, sans-serif;
    }
    #initial-loader .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e5e7eb;
      border-top-color: #000;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    #initial-loader p {
      margin-top: 16px;
      color: #71717a;
    }

    html{height:100%;margin:0;padding:0;overflow-x:hidden}
body{min-height:100%;margin:0;padding:0;overflow-x:hidden;max-width:100vw;display:flex;flex-direction:column}
#root{flex:1;display:flex;flex-direction:column;width:100%}
    .font-logo{font-family:system-ui,-apple-system,sans-serif;font-weight:600;letter-spacing:0.15em}
    .font-serif{font-family:Georgia,serif}
    .hide-scrollbar::-webkit-scrollbar{display:none}
    .hide-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
*{box-sizing:border-box}

/* BUTTON FEEDBACK - Press animation and hover effects */
button, a, [role="button"] {
  transition: transform 0.1s ease, opacity 0.15s ease;
}
button:active, a:active, [role="button"]:active {
  transform: scale(0.97);
  opacity: 0.9;
}
button:hover:not(:disabled), a:hover, [role="button"]:hover {
  opacity: 0.85;
}
button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Loading spinner for async operations */
@keyframes spin {
  to { transform: rotate(360deg); }
}
.loading-spinner {
  display: inline-block;
  width: 1rem;
  height: 1rem;
  border: 2px solid currentColor;
  border-right-color: transparent;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
  margin-right: 0.5rem;
  vertical-align: middle;
}
  </style>
</head>
<body class="bg-white text-zinc-900 antialiased">
  <!-- MOBILE FIX: Immediate visible loader before React loads -->
  <div id="initial-loader">
    <div class="spinner"></div>
    <p>Loading LÈVORE...</p>
  </div>

  <div id="root">
    <!-- Loading fallback -->
    <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; flex-direction: column; font-family: system-ui, sans-serif;">
      <div style="width: 48px; height: 48px; border: 4px solid #e5e7eb; border-top-color: #000; border-radius: 50%; animation: spin 1s linear infinite;"></div>
      <p style="margin-top: 16px; color: #71717a;">Loading LÈVORE...</p>
    </div>
  </div>
  <style>
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // Helper function to extract text from content (handles both string and JSON)
    function getContentText(content) {
      if (!content) return '';
      if (typeof content === 'string') return content;
      if (typeof content === 'object' && content.text) return content.text;
      if (Array.isArray(content)) return ''; // Array content is handled separately
      return String(content);
    }

    // Initialize Supabase client
    const supabase = window.supabase?.createClient(window.SUPABASE_URL || '', window.SUPABASE_ANON_KEY || '');

    // Hook to load collections and products from Supabase
    function useSupabaseCollections() {
      const [collections, setCollections] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      // Fallback demo products for when Supabase is unavailable (especially on mobile)
      const fallbackCollections = [
        {
          key: 'demo-collection',
          name: 'Featured Collection',
          tagline: 'Handcrafted luxury chocolate from Andhra Pradesh',
          story: 'Our signature collection showcasing the finest single-origin cacao beans.',
          color: 'from-amber-50 via-stone-50 to-white',
          products: [
            {
              sku: 'DEMO-001',
              name: '70% Dark Chocolate Bar',
              type: 'Dark Chocolate Bar',
              pack: 10,
              price: 450,
              blurb: 'Rich, intense dark chocolate with notes of cherry and vanilla',
              imgs: ['https://images.unsplash.com/photo-1511381939415-e44015466834?w=800&q=80'],
              img: 'https://images.unsplash.com/photo-1511381939415-e44015466834?w=800&q=80',
              link: '#',
              ingredients: 'Cacao beans, cane sugar, cocoa butter',
              story: 'Crafted from single-origin beans sourced from our partnered farms in Andhra Pradesh.'
            },
            {
              sku: 'DEMO-002',
              name: 'Milk Chocolate Truffle',
              type: 'Truffle',
              pack: 8,
              price: 550,
              blurb: 'Smooth milk chocolate with hazelnut center',
              imgs: ['https://images.unsplash.com/photo-1548907040-4baa42d10919?w=800&q=80'],
              img: 'https://images.unsplash.com/photo-1548907040-4baa42d10919?w=800&q=80',
              link: '#',
              ingredients: 'Milk chocolate, hazelnuts, cream',
              story: 'Hand-rolled truffles with fresh ingredients.'
            },
            {
              sku: 'DEMO-003',
              name: 'Single Origin 85%',
              type: 'Dark Chocolate Bar',
              pack: 12,
              price: 650,
              blurb: 'Bold and intense with fruity undertones',
              imgs: ['https://images.unsplash.com/photo-1511018556340-d16986a1c194?w=800&q=80'],
              img: 'https://images.unsplash.com/photo-1511018556340-d16986a1c194?w=800&q=80',
              link: '#',
              ingredients: 'Single-origin cacao beans, minimal sugar',
              story: 'Our darkest chocolate for true connoisseurs.'
            },
            {
              sku: 'DEMO-004',
              name: 'Caramel Sea Salt Bar',
              type: 'Milk Chocolate Bar',
              pack: 10,
              price: 500,
              blurb: 'Sweet and salty perfection',
              imgs: ['https://images.unsplash.com/photo-1606312619070-d48b4cda8bf6?w=800&q=80'],
              img: 'https://images.unsplash.com/photo-1606312619070-d48b4cda8bf6?w=800&q=80',
              link: '#',
              ingredients: 'Milk chocolate, caramel, Himalayan sea salt',
              story: 'A modern classic combining sweet and salty.'
            }
          ]
        }
      ];

      useEffect(() => {
        async function loadData() {
          // If no Supabase, use fallback immediately
          if (!supabase) {
            console.warn('Supabase not initialized - using fallback demo products');
            setCollections(fallbackCollections);
            setLoading(false);
            setError('Demo Mode: Using sample products');
            return;
          }

          try {
            // Fetch all collections
            const { data: collectionsData, error: collectionsError } = await supabase
              .from('collections')
              .select('*')
              .eq('is_active', true)
              .order('sort_order');

            if (collectionsError) throw collectionsError;

            // Fetch all products
            const { data: productsData, error: productsError } = await supabase
              .from('products')
              .select('*')
              .eq('is_active', true)
              .order('sort_order');

            if (productsError) throw productsError;

            // If we got data but it's empty, use fallback
            if (!collectionsData || collectionsData.length === 0 || !productsData || productsData.length === 0) {
              console.warn('No data in Supabase - using fallback demo products');
              setCollections(fallbackCollections);
              setLoading(false);
              setError('Demo Mode: Using sample products');
              return;
            }

            // Transform data to match original COLLECTIONS format
            const transformedCollections = (collectionsData || []).map(col => {
              // Get products for this collection
              const collectionProducts = (productsData || [])
                .filter(p => p.collection === col.slug)
                .map(p => ({
                  sku: p.sku,
                  name: p.name,
                  type: p.type || '',
                  pack: p.stock_quantity || 0, // Using stock as pack for now
                  price: parseFloat(p.price) || 0,
                  blurb: p.description || '',
                  imgs: p.gallery_urls && p.gallery_urls.length > 0 ? p.gallery_urls : [p.image_url],
                  img: p.image_url || '',
                  link: `https://rzp.io/l/${String(p.sku||'').toLowerCase()}`,
                  ingredients: p.metadata?.ingredients || '',
                  story: p.metadata?.story || p.description || '',
                  collectionName: col.name // Add collection name to product
                }));

              return {
                key: col.slug,
                name: col.name,
                tagline: col.description || '',
                story: col.description || '',
                color: 'from-amber-50 via-stone-50 to-white', // Default color
                products: collectionProducts
              };
            });

            setCollections(transformedCollections);
            setLoading(false);
            setError(null);
          } catch (err) {
            console.error('Error loading from Supabase:', err);
            console.warn('Falling back to demo products due to error');
            // Use fallback products on error (especially for mobile)
            setCollections(fallbackCollections);
            setError(`Demo Mode: ${err.message}`);
            setLoading(false);
          }
        }

        loadData();
      }, []);

      return { collections, loading, error };
    }

    // Hook to load hero sections
    function useHeroSections(page = 'home') {
      const [heroSections, setHeroSections] = useState([]);
      const [loading, setLoading] = useState(true);

      // Fallback hero data when database is not configured
      const fallbackHero = [{
        id: 1,
        page: 'home',
        title: 'Couture Chocolate,<br/><span class="font-serif italic">Woven in Fineness</span>',
        subtitle: 'LÈVORE · Bean-to-Bar Luxury',
        description: 'From Andhra Pradesh cacao farms to your moment of indulgence — crafted with intention, refined to 18–20μm silk.',
        cta_primary_text: 'Explore Collections',
        cta_primary_link: 'collections',
        image_url: 'https://images.unsplash.com/photo-1511381939415-e44015466834?w=1200&q=80',
        is_active: true,
        sort_order: 1
      }];

      useEffect(() => {
        async function loadHero() {
          if (!supabase) {
            console.warn('Supabase not initialized - using fallback hero data');
            setHeroSections(fallbackHero);
            setLoading(false);
            return;
          }
          try {
            const { data, error } = await supabase
              .from('hero_sections')
              .select('*')
              .eq('page', page)
              .eq('is_active', true)
              .order('sort_order');
            if (error) throw error;
            // Use fetched data if available, otherwise use fallback
            setHeroSections(data && data.length > 0 ? data : fallbackHero);
          } catch (err) {
            console.warn('Error loading hero sections, using fallback data:', err.message);
            setHeroSections(fallbackHero);
          }
          setLoading(false);
        }
        loadHero();
      }, [page]);

      return { heroSections, loading };
    }

    // Hook to load marketing sections
    function useMarketingSections(page = 'home') {
      const [sections, setSections] = useState({});
      const [loading, setLoading] = useState(true);

      // Fallback marketing data when database is not configured
      // Content can be either a string or JSON object with {text: "..."} 
      const fallbackSections = {
        'feature_1': {
          section_key: 'feature_1',
          section_type: 'feature',
          title: 'Ethically Sourced Cacao',
          content: {text: 'Our single-origin cacao beans are sourced directly from sustainable farms, ensuring quality and fairness at every step.'},
          image_url: 'https://images.unsplash.com/photo-1511018556340-d16986a1c194?w=600&q=80',
          is_active: true,
          sort_order: 1
        },
        'feature_2': {
          section_key: 'feature_2',
          section_type: 'feature',
          title: 'Small Batch Craftsmanship',
          content: {text: 'Each bar is handcrafted in small batches to preserve the unique flavor profiles and ensure exceptional quality.'},
          image_url: 'https://images.unsplash.com/photo-1548907040-4baa42d10919?w=600&q=80',
          is_active: true,
          sort_order: 2
        },
        'story': {
          section_key: 'story',
          section_type: 'story',
          title: 'From Andhra Pradesh to Your Table',
          content: {text: 'Born from a passion for excellence and rooted in local tradition, LÈVORE brings you chocolate that tells a story.'},
          image_url: 'https://images.unsplash.com/photo-1606312619070-d48b4cda8bf6?w=600&q=80',
          is_active: true,
          sort_order: 3
        }
      };

      useEffect(() => {
        async function loadSections() {
          if (!supabase) {
            console.warn('Supabase not initialized - using fallback marketing data');
            setSections(fallbackSections);
            setLoading(false);
            return;
          }
          try {
            const { data, error } = await supabase
              .from('marketing_sections')
              .select('*')
              .eq('page', page)
              .eq('is_active', true)
              .order('sort_order');
            if (error) throw error;
            
            if (data && data.length > 0) {
              const sectionsMap = {};
              data.forEach(section => {
                sectionsMap[section.section_key] = section;
              });
              setSections(sectionsMap);
            } else {
              // Use fallback if no data returned
              setSections(fallbackSections);
            }
          } catch (err) {
            console.warn('Error loading marketing sections, using fallback data:', err.message);
            setSections(fallbackSections);
          }
          setLoading(false);
        }
        loadSections();
      }, [page]);

      return { sections, loading };
    }

    // Hook to load static pages (privacy, terms, shipping, etc.)
    function usePage(slug) {
      const [page, setPage] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        async function loadPage() {
          if (!supabase) {
            setError('Supabase not initialized');
            setLoading(false);
            return;
          }
          
          try {
            const { data, error: fetchError } = await supabase
              .from('pages')
              .select('*')
              .eq('slug', slug)
              .eq('is_published', true)
              .single();
            
            if (fetchError) throw fetchError;
            setPage(data);
          } catch (err) {
            console.error(`Error loading page ${slug}:`, err);
            setError(err.message);
          }
          setLoading(false);
        }
        
        loadPage();
      }, [slug]);

      return { page, loading, error };
    }

    // Hook to load story content
    function useStoryContent() {
      const [storyContent, setStoryContent] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        async function loadStory() {
          if (!supabase) {
            setStoryContent([]);
            setLoading(false);
            return;
          }
          try {
            const { data, error } = await supabase
              .from('story_content')
              .select('*')
              .eq('is_active', true)
              .order('sort_order');
            if (error) throw error;
            setStoryContent(data || []);
          } catch (err) {
            console.error('Error loading story content:', err);
            setStoryContent([]);
          }
          setLoading(false);
        }
        loadStory();
      }, []);

      return { storyContent, loading };
    }

    // Hook to load FAQs
    function useFAQs() {
      const [faqs, setFaqs] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        async function loadFAQs() {
          if (!supabase) {
            setFaqs([]);
            setLoading(false);
            return;
          }
          try {
            const { data, error } = await supabase
              .from('faqs')
              .select('*')
              .eq('is_active', true)
              .order('sort_order');
            if (error) throw error;
            setFaqs(data || []);
          } catch (err) {
            console.error('Error loading FAQs:', err);
            setFaqs([]);
          }
          setLoading(false);
        }
        loadFAQs();
      }, []);

      return { faqs, loading };
    }

    // Hook to load gifting content
    function useGiftingContent() {
      const [giftingContent, setGiftingContent] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        async function loadGifting() {
          if (!supabase) {
            setGiftingContent([]);
            setLoading(false);
            return;
          }
          try {
            const { data, error } = await supabase
              .from('gifting_content')
              .select('*')
              .eq('is_active', true)
              .order('sort_order');
            if (error) throw error;
            setGiftingContent(data || []);
          } catch (err) {
            console.error('Error loading gifting content:', err);
            setGiftingContent([]);
          }
          setLoading(false);
        }
        loadGifting();
      }, []);

      return { giftingContent, loading };
    }

    // Hook to load corporate gifting content
    function useCorporateGiftingContent() {
      const [corporateContent, setCorporateContent] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        async function loadCorporate() {
          if (!supabase) {
            setCorporateContent([]);
            setLoading(false);
            return;
          }
          try {
            const { data, error } = await supabase
              .from('corporate_gifting_content')
              .select('*')
              .eq('is_active', true)
              .order('sort_order');
            if (error) throw error;
            setCorporateContent(data || []);
          } catch (err) {
            console.error('Error loading corporate gifting content:', err);
            setCorporateContent([]);
          }
          setLoading(false);
        }
        loadCorporate();
      }, []);

      return { corporateContent, loading };
    }

    // Hook to load certifications
    function useCertifications() {
      const [certifications, setCertifications] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        async function loadCertifications() {
          if (!supabase) {
            setCertifications([]);
            setLoading(false);
            return;
          }
          try {
            const { data, error } = await supabase
              .from('certifications')
              .select('*')
              .eq('is_active', true)
              .order('sort_order');
            if (error) throw error;
            setCertifications(data || []);
          } catch (err) {
            console.error('Error loading certifications:', err);
            setCertifications([]);
          }
          setLoading(false);
        }
        loadCertifications();
      }, []);

      return { certifications, loading };
    }

    // Hook to load contact info
    function useContactInfo() {
      const [contactInfo, setContactInfo] = useState({});
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        async function loadContact() {
          if (!supabase) {
            setContactInfo({});
            setLoading(false);
            return;
          }
          try {
            const { data, error } = await supabase
              .from('contact_info')
              .select('*')
              .eq('is_active', true);
            if (error) throw error;
            const contactMap = {};
            (data || []).forEach(item => {
              contactMap[item.key] = item;
            });
            setContactInfo(contactMap);
          } catch (err) {
            console.error('Error loading contact info:', err);
            setContactInfo({});
          }
          setLoading(false);
        }
        loadContact();
      }, []);

      return { contactInfo, loading };
    }

    // Hook to load blog posts
    function useBlogPosts() {
      const [blogPosts, setBlogPosts] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        async function loadBlog() {
          if (!supabase) {
            setBlogPosts([]);
            setLoading(false);
            return;
          }
          try {
            const { data, error } = await supabase
              .from('blog_posts')
              .select('*')
              .eq('is_published', true)
              .order('published_date', { ascending: false });
            if (error) throw error;
            setBlogPosts(data || []);
          } catch (err) {
            console.error('Error loading blog posts:', err);
            setBlogPosts([]);
          }
          setLoading(false);
        }
        loadBlog();
      }, []);

      return { blogPosts, loading };
    }

    // Hook to load a single blog post by slug
    function useBlogPost(slug) {
      const [blogPost, setBlogPost] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        async function loadPost() {
          if (!supabase || !slug) {
            setBlogPost(null);
            setLoading(false);
            return;
          }
          try {
            const { data, error } = await supabase
              .from('blog_posts')
              .select('*')
              .eq('slug', slug)
              .eq('is_published', true)
              .single();
            if (error) throw error;
            setBlogPost(data);
          } catch (err) {
            console.error('Error loading blog post:', err);
            setBlogPost(null);
          }
          setLoading(false);
        }
        loadPost();
      }, [slug]);

      return { blogPost, loading };
    }

    function useHashNavigation(route, setRoute) {
  useEffect(() => {
    function handleHashChange() {
      const hash = window.location.hash.slice(2) || 'home';
      const [page, param] = hash.split('/');
      setRoute({ page: page || 'home', param: param || null });
      setTimeout(() => window.scrollTo(0, 0), 0);
    }
    window.addEventListener('hashchange', handleHashChange);
    handleHashChange();
    return () => window.removeEventListener('hashchange', handleHashChange);
  }, [setRoute]);

  function navigate(page, param = null) {
    const hash = param ? `#/${page}/${param}` : `#/${page}`;
    window.location.hash = hash;
  }

  return navigate;
}

    function loadRazorpayScript() {
      return new Promise((resolve) => {
        // Check if already loaded
        if (window.Razorpay) {
          console.log('Razorpay already loaded');
          return resolve(true);
        }
        
        // Check if script tag already exists
        const existing = document.querySelector('script[src*="razorpay"]');
        if (existing) {
          console.log('Razorpay script tag exists, waiting for load...');
          existing.onload = () => resolve(true);
          existing.onerror = () => resolve(false);
          // If already loaded but window.Razorpay not available yet, wait a bit
          setTimeout(() => {
            if (window.Razorpay) resolve(true);
          }, 500);
          return;
        }
        
        console.log('Loading Razorpay script...');
        const s = document.createElement("script");
        s.src = "https://checkout.razorpay.com/v1/checkout.js";
        s.onload = () => {
          console.log('Razorpay loaded successfully');
          resolve(true);
        };
        s.onerror = (err) => {
          console.error('Failed to load Razorpay:', err);
          resolve(false);
        };
        document.head.appendChild(s); // Load in head for better reliability
      });
    }

    async function openRazorpayCheckout(cart, products, cartTotal, customer) {
  console.log('Opening Razorpay checkout...');
  const ok = await loadRazorpayScript();
  if (!ok) { 
    alert("Couldn't load Razorpay payment gateway. Please check your internet connection and try again."); 
    return; 
  }
  
  if (!window.Razorpay) {
    alert("Payment gateway not ready. Please refresh the page and try again.");
    return;
  }
  
  const lines = cart.map(l => {
    const p = products.find(x => x.sku === l.sku);
    return `${p?.name||'Item'} × ${l.qty} = ₹${(p?.price||0)*l.qty}`;
  }).join(" | ");
  const amountPaise = Math.round((+cartTotal || 0) * 100);
  
  console.log('Creating order...');
  const res = await fetch("/.netlify/functions/create-order", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      amount: amountPaise,
      notes: {
        lines,
        customer_name: customer?.name || "",
        customer_phone: customer?.phone || "",
        customer_email: customer?.email || "",
        customer_address: customer?.address || "",
      }
    })
  });
  
  if (!res.ok) { 
    const errorText = await res.text();
    console.error('Order creation failed:', errorText);
    alert("Order creation failed: " + errorText); 
    return; 
  }
  
  const order = await res.json();
  console.log('Order created, opening Razorpay UI...');
  
  const rzp = new window.Razorpay({
    key: "rzp_live_RZZDfUNCA1W70J", // ⚠️ REPLACE WITH YOUR ACTUAL RAZORPAY KEY
    amount: order.amount,
    currency: order.currency,
    name: "LÈVORE",
    description: "Checkout",
    order_id: order.id,
    handler: async function (response) {
      try {
        // Verify payment on backend
        const verifyResponse = await fetch('/.netlify/functions/verify-payment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            razorpay_order_id: response.razorpay_order_id,
            razorpay_payment_id: response.razorpay_payment_id,
            razorpay_signature: response.razorpay_signature,
            cart: cart,
            customer: customer,
            total: cartTotal
          })
        });
        
        const verifyData = await verifyResponse.json();
        
        if (verifyData.success) {
          // Create shipment automatically
          try {
            await fetch('/.netlify/functions/create-shipment', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ orderId: verifyData.order.id })
            });
          } catch (shipError) {
            console.error('Shipment creation failed:', shipError);
            // Continue anyway - order is saved
          }
          
          alert(`Payment successful! Order #${verifyData.order.order_number}\nYou'll receive tracking details soon.`);
          window.location.hash = '#/account';
        } else {
          alert('Payment verification failed. Please contact support.');
        }
      } catch (error) {
        console.error('Payment error:', error);
        alert('Payment processing failed. Please try again or contact support.');
      }
    },
    prefill: {
      name: customer?.name || "",
      email: customer?.email || "",
      contact: customer?.phone || "",
    },
    notes: order.notes || {},
    theme: { color: "#111111" }
  });
  
  rzp.open();
}

    const IMG = {
      hero1: "https://images.unsplash.com/photo-1606313564200-e75d5e30476e?q=80&w=1600&auto=format&fit=crop",
      dark1: "https://images.unsplash.com/photo-1551024709-8f23befc6cf7?q=80&w=1600&auto=format&fit=crop",
      dark2: "https://images.unsplash.com/photo-1541696432-82c6da8ce7bf?q=80&w=1600&auto=format&fit=crop",
      milk1: "https://images.unsplash.com/photo-1541976590-713941681591?q=80&w=1600&auto=format&fit=crop",
      pack1: "https://images.unsplash.com/photo-1519681390220-871db9c9f6d5?q=80&w=1600&auto=format&fit=crop",
      slice1:"https://images.unsplash.com/photo-1532102235690-b2c93495d4e3?q=80&w=1600&auto=format&fit=crop",
    };
    
    const six = (a,b,c,d,e,f)=>[a,b,c,d,e,f];
    const heroSet = ()=> six(IMG.dark1, IMG.dark2, IMG.milk1, IMG.dark1, IMG.pack1, IMG.slice1);
    const bonSet = ()=> six(IMG.dark1, IMG.milk1, IMG.dark2, IMG.pack1, IMG.slice1, IMG.dark1);
    const barkSet = ()=> six(IMG.slice1, IMG.dark1, IMG.milk1, IMG.pack1, IMG.dark2, IMG.dark1);
    const nutSet = ()=> six(IMG.pack1, IMG.dark1, IMG.milk1, IMG.slice1, IMG.dark2, IMG.dark1);
    const milkSet = ()=> six(IMG.milk1, IMG.dark1, IMG.pack1, IMG.slice1, IMG.dark2, IMG.milk1);
    const whiteSet = ()=> six(IMG.milk1, IMG.pack1, IMG.slice1, IMG.dark1, IMG.milk1, IMG.dark2);

    function makeSku(code, name, type, pack, price, blurb, imgs, meta={}) {
      return {
        sku: code, name, type, pack, price, blurb, imgs,
        img: imgs[0],
        link: `https://rzp.io/l/${String(code||'').toLowerCase()}`,
        ingredients: meta.ingredients || "",
        story: meta.story || "",
      };
    }

    /* 
    ============================================
    COLLECTIONS ARRAY - NOW LOADED FROM SUPABASE
    ============================================
    The collections and products are now dynamically loaded from your Supabase database
    using the useSupabaseCollections() hook in the App component.
    
    To update products/collections, edit them in your Supabase dashboard instead of here.
    
    The hardcoded COLLECTIONS array below is commented out but kept for reference.
    */
    
    /*
    const COLLECTIONS = [
  {
    key:"regal", name:"The Regal Collection",
    tagline:"Opulence, courtly flavors, jewel-box textures.",
    story:"Inspired by palatial courts and the jewel craft of the Deccan, these are chocolates for grand gestures — bold, layered, and resplendent.",
    color:"from-amber-200 via-yellow-100 to-amber-50",
    products:[
      makeSku("RG-EMN","Emerald Nougatine","Bon-bons",9,1099,"Pistachio-almond praline in dark couverture.",bonSet(),{ingredients:"Cacao mass, pistachio, almond, sugar, cocoa butter.",story:"Emerald-glow praline under a dark sheen."}),
      makeSku("RG-RBY","Ruby Caramel","Bon-bons",9,1099,"Salted caramel in ruby couverture.",bonSet(),{ingredients:"Ruby chocolate, sugar, cream, butter, sea salt.",story:"A jewel-toned caramel with a wink of salt."}),
      makeSku("RG-GHZ","Golden Ghazal","Barks",200,899,"Saffron-almond bark with rose flecks.",barkSet(),{ingredients:"Cacao mass, almond, saffron, rose, sugar, cocoa butter.",story:"Perfumed shards for ornate evenings."}),
      makeSku("RG-CBR","Court Brocade","Bars",70,399,"70% single-origin dark, date & caramel notes.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"A classic dark with royal poise."}),
      makeSku("RG-JWL","Jewel Dragees","Dragees",180,749,"Roasted nut medley in thin shells.",nutSet(),{ingredients:"Almond, cashew, hazelnut, chocolate, sugar.",story:"Precious little beads of crunch."}),
      makeSku("RG-ROC","Raj Rochers","Rochers",9,949,"Caramelized nut clusters in milk chocolate.",nutSet(),{ingredients:"Milk chocolate, mixed nuts, sugar, cocoa butter.",story:"Crowd-pleasing crunch with courtly charm."}),
      makeSku("RG-THN","Sceptre Thins","Thins",90,549,"Wafer-thin dark sheets with gold sea-salt.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter, sea salt.",story:"A crisp, regal snap."}),
      makeSku("RG-HSB","Maharaja Hand-Scooped","Hand-Scooped Bar",70,699,"Layered ganache, praline & fruit — inspired by hand-scooped craft.",heroSet(),{ingredients:"Dark chocolate, praline, fruit gel, cocoa butter.",story:"A palatial slice in bar form."}),
    ]
  },
  {
    key:"elan", name:"The Élan Collection",
    tagline:"Celebrations, birthdays, exuberant textures.",
    story:"Confetti energy for milestone moments. Bright inclusions, playful crunch, and a glow that lingers after the candles fade.",
    color:"from-pink-100 via-rose-50 to-white",
    products:[
      makeSku("EL-CNF","Confetti Crunch","Bars",54,349,"Milk-dark with honeycomb shards and sprinkles.",milkSet(),{ingredients:"Chocolate, honeycomb, sugar, cocoa butter.",story:"Candles out, sparkle on."}),
      makeSku("EL-MNW","Midnight Wish","Nama",16,1199,"Nama dark squares, velvet melt.",heroSet(),{ingredients:"Dark chocolate, cream, cocoa butter.",story:"The wish you keep for yourself."}),
      makeSku("EL-CLC","Candlelight Citrus","Barks",200,799,"Candied orange peel & toasted almond in dark.",barkSet(),{ingredients:"Dark chocolate, orange peel, almond, sugar.",story:"A citrus glow in crisp shards."}),
      makeSku("EL-SPR","Spark Thins","Thins",90,499,"Wafer-thin milk chocolate with popping sugar.",milkSet(),{ingredients:"Milk chocolate, popping sugar.",story:"A little firework with every bite."}),
      makeSku("EL-BNB","Balloon Bon-bons","Bon-bons",9,999,"Vanilla marshmallow core wrapped in 54% couverture.",bonSet(),{ingredients:"Chocolate, vanilla, sugar, gelatin.",story:"Pillowy puffs for party hearts."}),
      makeSku("EL-SNG","Song & Sparkle","Dragees",180,699,"Crispy pearls and nutty spheres.",nutSet(),{ingredients:"Cereal pearls, nuts, chocolate.",story:"Crunch to the rhythm of the night."}),
      makeSku("EL-ROC","Ribbon Rochers","Rochers",9,899,"Crunchy nut clusters with honeycomb crackle.",nutSet(),{ingredients:"Honeycomb, nuts, chocolate.",story:"A bow-tied bite of joy."}),
      makeSku("EL-HSB","Birthday Hand-Scooped","Hand-Scooped Bar",70,649,"Layered mousse & fruit — party inside a bar.",heroSet(),{ingredients:"Chocolate, fruit gel, praline, cocoa butter.",story:"Make a wish, then bite it."}),
    ]
  },
  {
    key:"sacred", name:"The Sacred Collection",
    tagline:"Ritual purity, temple grace, quiet luxury.",
    story:"Offerings crafted with restraint. Clean labels, devotional flavors, minimal design — chocolate as a modern prasadam.",
    color:"from-emerald-50 via-lime-50 to-white",
    products:[
      makeSku("SC-TUL","Tulsi Truffle","Bon-bons",9,1049,"Dark ganache perfumed with tulsi.",bonSet(),{ingredients:"Dark chocolate, cream, tulsi, cocoa butter.",story:"A calm, herb-perfumed centre."}),
      makeSku("SC-LOT","Lotus Offering","Rochers",9,949,"Rose-pistachio rochers in ivory couverture.",whiteSet(),{ingredients:"White chocolate, pistachio, rose.",story:"A floral crunch, softly sweet."}),
      makeSku("SC-CHT","Chanting Chai","Bars",45,329,"Spiced milk bar with cardamom & cinnamon.",milkSet(),{ingredients:"Milk chocolate, spices.",story:"A temple of warmth in a bar."}),
      makeSku("SC-PRH","Prasad Thins","Thins",90,499,"Minimal jaggery thins, palm-oil free.",heroSet(),{ingredients:"Dark chocolate, jaggery.",story:"Simple, true, offering-like."}),
      makeSku("SC-VTR","Votive Dragees","Dragees",150,679,"Roasted chana & peanut dragees.",nutSet(),{ingredients:"Roasted chana, peanut, chocolate.",story:"Earthy crunch, honest sweetness."}),
      makeSku("SC-ATN","Aarti Nama","Nama",16,1149,"Nama milk with saffron-cardamom.",milkSet(),{ingredients:"Milk chocolate, cream, saffron, cardamom.",story:"A quiet hymn in silk."}),
      makeSku("SC-ROC","Temple Rochers","Rochers",9,949,"Sesame-jaggery praline rochers.",nutSet(),{ingredients:"Sesame, jaggery, chocolate.",story:"A sacred crunch."}),
      makeSku("SC-HSB","Prasadam Hand-Scooped","Hand-Scooped Bar",70,629,"Layered jaggery-praline with spice notes.",heroSet(),{ingredients:"Chocolate, jaggery, spice praline.",story:"Ritual, reimagined."}),
    ]
  },
  {
    key:"voyage", name:"Voyage Editions",
    tagline:"Journeys in taste, stamps in memory.",
    story:"A traveler's atlas told in cacao — monsoons, markets, ateliers. Every bar a place, every bite a story.",
    color:"from-sky-50 via-indigo-50 to-white",
    products:[
      makeSku("VG-VNV","Varanasi Velvet","Bars",68,399,"Dark jaggery bar with toasted sesame.",heroSet(),{ingredients:"Dark chocolate, jaggery, sesame.",story:"Ganga dusk, toasted and deep."}),
      makeSku("VG-KRM","Kerala Monsoon","Nama",16,1199,"Coconut-milk nama with sea-salt accent.",milkSet(),{ingredients:"Milk chocolate, coconut cream, sea salt.",story:"Rain on palm leaves, in silk."}),
      makeSku("VG-DEL","Delhi Dusk","Barks",200,799,"Spiced almond bark with black pepper & orange.",barkSet(),{ingredients:"Dark chocolate, almond, pepper, orange peel.",story:"Bazaar heat, citrus cool."}),
      makeSku("VG-PRS","Paris Atelier","Bars",70,449,"70% single-origin with lavender.",heroSet(),{ingredients:"Dark chocolate, lavender.",story:"An atelier whisper in bloom."}),
      makeSku("VG-TRN","Trani Port","Dragees",180,749,"Fig & almond dragees — sun-dried sweetness.",nutSet(),{ingredients:"Fig, almond, chocolate.",story:"Stone alleys, warm fruit."}),
      makeSku("VG-BZR","Bazaar Barks","Barks",200,799,"Pistachio, rose & apricot shards in dark.",barkSet(),{ingredients:"Dark chocolate, pistachio, rose, apricot.",story:"Spice-lane romance."}),
      makeSku("VG-ROC","Traveler Rochers","Rochers",9,949,"Hazelnut & raisin praline clusters.",nutSet(),{ingredients:"Hazelnut, raisin, chocolate.",story:"A pocket of places."}),
      makeSku("VG-HSB","Passport Hand-Scooped","Hand-Scooped Bar",70,659,"Layered origin-inspired ganaches.",heroSet(),{ingredients:"Dark chocolate, assorted ganaches.",story:"Stamped in layers."}),
    ]
  },
  {
    key:"origins", name:"Grand Cru Origins",
    tagline:"Single-origin bars that speak terroir.",
    story:"Estate cacao expressed with restraint — roast & conche tuned to reveal each land's signature.",
    color:"from-amber-50 via-stone-50 to-white",
    products:[
      makeSku("OR-WGD","West Godavari 70%","Bars",70,449,"Date, raisin, warm spice.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"Andhra warmth in dark silk."}),
      makeSku("OR-KRL","Kerala 72%","Bars",70,469,"Peppery cacao, palm sugar warmth.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"Rain-green hush, cocoa-deep."}),
      makeSku("OR-CHN","Chennai 64%","Bars",70,429,"Tamarind-like tartness, dark jaggery finish.",milkSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"Marina winds, tang and dusk."}),
      makeSku("OR-VNM","Vietnam 70%","Bars",70,499,"Red fruit, honey, delicate tannins.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"Dragonfruit skies, bright and clean."}),
      makeSku("OR-MDR","Madre de Dios 73%","Bars",70,549,"Amazonian florals, clean finish.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"Rainforest hush, pristine."}),
      makeSku("OR-MDG","Madagascar 68%","Bars",70,549,"Citrus-berry brightness, silky.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"Lemongrass light, berry bright."}),
      makeSku("OR-GHA","Ghana 65%","Bars",70,429,"Classic cocoa, caramel, nutty.",milkSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"Bold, round, familiar — in the best way."}),
      makeSku("OR-HSB","Origin Layers Hand-Scooped","Hand-Scooped Bar",70,699,"Stacked single-origin ganaches.",heroSet(),{ingredients:"Dark chocolate, ganache layers.",story:"A flight you can hold."}),
    ]
  },
  {
    key:"couture", name:"The Couture Collection",
    tagline:"Limited lots, numbered editions, hand-finished.",
    story:"Our atelier line — editions that never repeat, signed by the chocolatier. Texture studies, origin flights, and gilded experiments.",
    color:"from-zinc-100 via-slate-50 to-white",
    products:[
      makeSku("CT-SLK","Silken Conche","Nama",16,1299,"Nama dark refined to ~18–20μm — ephemeral melt.",heroSet(),{ingredients:"Dark chocolate, cream, cocoa butter.",story:"A study in silk."}),
      makeSku("CT-BRC","Brocade Bloom","Bon-bons",9,1199,"Rose ganache, pistachio crunch, 23k gold leaf.",bonSet(),{ingredients:"Chocolate, pistachio, rose, sugar.",story:"Gilded, but not loud."}),
      makeSku("CT-MUS","Moonlit Muslin","Nama",16,1299,"White nama with vanilla bean specks.",whiteSet(),{ingredients:"White chocolate, cream, vanilla.",story:"White-on-white, whisper-soft."}),
      makeSku("CT-AT1","Atelier Flight No.1","Bars",90,1399,"Three 30g origin bars — roast & conche variations.",heroSet(),{ingredients:"Dark chocolate (assorted).",story:"Technique in triplicate."}),
      makeSku("CT-ROC","Gilded Rochers","Rochers",9,1199,"Hazelnut praline rochers with a gold shimmer.",nutSet(),{ingredients:"Hazelnut, chocolate, sugar.",story:"A baroque crunch."}),
      makeSku("CT-THN","Silk & Knife","Thins",90,599,"Ultrathin 70% sheets that shatter with a whisper.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"Edges as elegant as fabric-cut."}),
      makeSku("CT-BON","Haute Bon-bons","Bon-bons",9,1299,"Seasonal palette, hand-painted shells.",bonSet(),{ingredients:"Chocolate, butter, sugar.",story:"Wearable art, but edible."}),
      makeSku("CT-HSB","Signature Hand-Scooped","Hand-Scooped Bar",70,699,"One-off layered bars, numbered.",heroSet(),{ingredients:"Dark chocolate, layered fillings.",story:"A collector's slice."}),
    ]
  },
  {
    key:"scoop", name:"The Scoop Atelier",
    tagline:"Layered bars, hand-finished — decadent stories in strata.",
    story:"An homage to European hand-scooped craft — playful layers of ganache, praline, fruit and crunch, interpreted through Indian sensibilities.",
    color:"from-fuchsia-50 via-rose-50 to-white",
    products:[
      makeSku("SP-TRZ","Trio Truffle Torte","Hand-Scooped Bar",70,699,"Dark ganache • hazelnut praline • feuilletine.",heroSet(),{ingredients:"Dark chocolate, hazelnut, feuilletine.",story:"Three layers, endless drama."}),
      makeSku("SP-SAF","Saffron Opera","Hand-Scooped Bar",70,719,"Saffron cream • almond praline • dark shell.",heroSet(),{ingredients:"Dark chocolate, saffron cream, almond praline.",story:"Opera in amber notes."}),
      makeSku("SP-RBY","Ruby Lassi","Hand-Scooped Bar",70,699,"Ruby yoghurt cream • rose gel • pistachio crunch.",whiteSet(),{ingredients:"Ruby chocolate, yoghurt cream, pistachio, rose.",story:"A pink-hued daydream."}),
      makeSku("SP-TRS","Tiramisu Silk","Hand-Scooped Bar",70,709,"Mascarpone cream • coffee ganache • cocoa dust.",milkSet(),{ingredients:"Milk chocolate, mascarpone, coffee.",story:"Cafe velvet in a bar."}),
      makeSku("SP-APL","Apple Strudel","Hand-Scooped Bar",70,699,"Spiced apple confit • biscuit crunch • white shell.",whiteSet(),{ingredients:"White chocolate, apple, spice, biscuit.",story:"Autumn layered bright."}),
      makeSku("SP-CRN","Caramel Corn Silk","Hand-Scooped Bar",70,679,"Salted caramel • cornflake praline • milk shell.",milkSet(),{ingredients:"Milk chocolate, caramel, cornflake.",story:"Cinema nights, upgraded."}),
      makeSku("SP-MCH","Matcha Opera","Hand-Scooped Bar",70,729,"Matcha cream • white ganache • sesame crisp.",whiteSet(),{ingredients:"White chocolate, matcha, sesame.",story:"Green notes, calm bite."}),
      makeSku("SP-RUM","Rum Raisin Royale","Hand-Scooped Bar",70,739,"Rum-kissed raisin cream • dark ganache.",heroSet(),{ingredients:"Dark chocolate, raisin, rum. Contains alcohol.",story:"A classic, grown with grace."}),
    ]
  },
  {
    key:"seasonal", name:"Seasonal Festive Edits",
    tagline:"Limited-time celebrations crafted in chocolate.",
    story:"India's festive calendar reimagined as edible art — nostalgic flavors, joyful textures, and gift-ready designs.",
    color:"from-orange-50 via-amber-50 to-white",
    products:[
      makeSku("SF-DWL","Diwali Diyas Bon-bons","Bon-bons",9,1149,"Saffron-cardamom caramel in dark shells, a crackle of pistachio.",bonSet(),{ingredients:"Dark chocolate, caramel, saffron, cardamom, pistachio.",story:"Lamp-warm sweetness."}),
      makeSku("SF-RKH","Rakhi Almond Rochers","Rochers",9,979,"Caramelized almond praline clusters — tie with love.",nutSet(),{ingredients:"Almond, sugar, chocolate.",story:"A sibling ritual in crunch."}),
      makeSku("SF-HOL","Holi Basundi Nama","Nama",16,1199,"Ivory nama kissed with basundi spices — creamy and bright.",whiteSet(),{ingredients:"White chocolate, cream, basundi spice.",story:"Colors melt to cream."}),
      makeSku("SF-XMS","Christmas Stollen Bark","Barks",200,849,"Candied citrus, raisin and marzipan notes in dark bark.",barkSet(),{ingredients:"Dark chocolate, citrus, raisin, almond.",story:"Carols in crisp shards."}),
      makeSku("SF-SNK","Sankranti Sesame Thins","Thins",90,529,"Jaggery-til brittle reinterpreted as ultra-thin sheets.",heroSet(),{ingredients:"Dark chocolate, jaggery, sesame.",story:"Harvest, thinned to elegance."}),
      makeSku("SF-EID","Eid Ajwa Dragees","Dragees",180,799,"Ajwa date bits and roasted nuts in crisp shells.",nutSet(),{ingredients:"Ajwa dates, nuts, chocolate.",story:"Moon-sighting sweetness."}),
      makeSku("SF-PNG","Pongal Jaggery Bar","Bars",70,449,"Milk bar with palm jaggery and toasted rice crisps.",milkSet(),{ingredients:"Milk chocolate, palm jaggery, rice crisps.",story:"Warm bowl, crisp bite."}),
      makeSku("SF-HSB","Festival Layer Cake","Hand-Scooped Bar",70,719,"Layers of kesar cream, nut praline and fruit confit — pure celebration.",heroSet(),{ingredients:"Chocolate, kesar cream, praline, fruit gel.",story:"A calendar of festivities in strata."}),
    ]
  },
  {
    key:"zmode", name:"Z-Mode — Gen Z",
    tagline:"Hustle. Heal. Have fun.",
    story:"Built for all-nighters, gym sessions and soft-life Sundays. Real cacao + smart inclusions — playful, not preachy.",
    color:"from-violet-50 via-fuchsia-50 to-white",
    products:[
      makeSku("ZM-NFP","No-Filter Protein Bar","Bars",58,399,"60% dark-milk with pea protein, dates & almond butter.",heroSet(),{ingredients:"Cacao, milk solids, pea protein, almond butter, dates, cocoa butter, sugar.",story:"Fuel for study marathons and side hustles."}),
      makeSku("ZM-GBD","Glow Berry Dragees","Dragees",160,749,"Dark shells over freeze-dried berry crunch.",nutSet(),{ingredients:"Cacao mass, berries, sugar, cocoa butter.",story:"Screen-time snack with real fruit sparkle."}),
      makeSku("ZM-LSB","Lift-Off Superseed Bark","Barks",200,799,"Pumpkin, flax, chia in 66% dark; lightly jaggery-kissed.",barkSet(),{ingredients:"Cacao mass, jaggery, pumpkin, flax, chia.",story:"Crunch that keeps up with gym days."}),
      makeSku("ZM-CMN","Calm Mode Nama","Nama",16,1199,"Milk nama with tulsi & vanilla — quiet, creamy, cozy.",milkSet(),{ingredients:"Milk chocolate, cream, cocoa butter, tulsi, vanilla.",story:"Wind-down squares for soft evenings."}),
      makeSku("ZM-SMT","Swipe-Right Mint Thins","Thins",90,499,"58% mint thins; crisp, selfie-proof breath.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter, natural mint oil.",story:"Fresh takes for first dates and first gigs."}),
      makeSku("ZM-CMR","Crunch Mode Rochers","Rochers",9,949,"Peanut–sesame praline clusters; salty-sweet.",nutSet(),{ingredients:"Peanut, sesame, sugar, cacao, cocoa butter.",story:"The 'send it' crunch between calls."}),
      makeSku("ZM-FFB","Focus Flow Bon-bons","Bon-bons",9,1049,"Espresso–caramel centers in 64% dark.",bonSet(),{ingredients:"Coffee caramel, cacao mass, sugar, cream.",story:"A clear kick — say it with focus."}),
      makeSku("ZM-ALN","All-Nighter Hand-Scooped","Hand-Scooped Bar",70,699,"Mocha ganache • feuilletine crunch • origin shell.",heroSet(),{ingredients:"Cacao mass, coffee, cream, feuilletine, cocoa butter.",story:"Project mode, but delicious."}),
    ]
  },
  {
    key:"littles", name:"LÈVORE Littles",
    tagline:"Clean chocolate for big imaginations.",
    story:"Snack-size joy with simple ingredients parents trust. Smaller portions, muscovado sugar, gentle flavors, and playful shapes — zero artificial stuff.",
    color:"from-amber-50 via-orange-50 to-white",
    products:[
      makeSku("LT-GGM","Galaxy Giggles Minis","Bars",120,399,"38% milk minis with muscovado & vanilla — lunchbox-friendly.",milkSet(),{ingredients:"Cacao, milk solids, muscovado sugar, cocoa butter, vanilla.",story:"Pocket-sized stars for tiny explorers."}),
      makeSku("LT-TPB","Treasure Pebbles","Dragees",150,649,"Crisp gram-puff pearls coated in milk chocolate.",nutSet(),{ingredients:"Roasted gram puffs, milk chocolate, cocoa butter.",story:"Hide-and-seek snack treasure."}),
      makeSku("LT-RFB","Rainbow Fruit Bark","Barks",180,749,"Freeze-dried mango & strawberry in 45% milk bark.",barkSet(),{ingredients:"Milk chocolate, dried mango, strawberry, cocoa butter.",story:"Fruit confetti for after-school smiles."}),
      makeSku("LT-CLN","Cloud Pillow Nama","Nama",12,899,"Extra-milk nama; super mellow melt.",milkSet(),{ingredients:"Milk chocolate, cream, cocoa butter.",story:"Soft as a nap, sweet as a giggle."}),
      makeSku("LT-DTH","Dino Thins","Thins",80,449,"Dino-stamped thins with rice crisps.",whiteSet(),{ingredients:"Milk chocolate, rice crisps, cocoa butter.",story:"Roar-some crunch without the sugar roar."}),
      makeSku("LT-CCR","Crunch Clouds Rochers","Rochers",9,799,"Cornflake-praline clusters; big crunch, small sweetness.",nutSet(),{ingredients:"Cornflakes, nuts, milk chocolate.",story:"Weekend movie-night munchies."}),
      makeSku("LT-HPB","Hide-&-Peek Bon-bons","Bon-bons",9,899,"Mild hazelnut butter centers (nut-free option available).",bonSet(),{ingredients:"Hazelnut butter, milk chocolate (or sunflower butter).",story:"Peekaboo centers, honest ingredients."}),
      makeSku("LT-BCS","Birthday Confetti Hand-Scooped","Hand-Scooped Bar",60,649,"Cake-cream layer + natural-color sprinkles.",heroSet(),{ingredients:"Milk chocolate, cream, cocoa butter, natural sprinkles.",story:"Party-in-a-bar, parent-approved."}),
    ]
  },
  {
    key:"reverie", name:"The Reverie Collection",
    tagline:"A private ritual, poured in chocolate.",
    story:"For the solo treat — journaling, a favorite song, a bath, a soft chair. Silky textures, perfumed notes, quiet luxury.",
    color:"from-slate-50 via-zinc-50 to-white",
    products:[
      makeSku("RV-MS7","Midnight Silk 72%","Bars",70,449,"Single-origin dark — satin mouthfeel, berry-citrus whisper.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"Lights low, senses high."}),
      makeSku("RV-WHT","Whisper Thins","Thins",90,599,"Paper-thin 70% sheets that shatter elegantly.",heroSet(),{ingredients:"Cacao mass, sugar, cocoa butter.",story:"A hush that crackles."}),
      makeSku("RV-CN1","Cloud-Nine Nama","Nama",16,1299,"Dark nama with crème-fraîche tang; floaty finish.",milkSet(),{ingredients:"Dark chocolate, cream, cocoa butter.",story:"A soft landing after a long day."}),
      makeSku("RV-CSR","Cashmere Rochers","Rochers",9,1199,"Macadamia–pecan praline clusters; buttery, plush.",nutSet(),{ingredients:"Macadamia, pecan, sugar, cocoa butter, cacao.",story:"Plush textures, velvet calm."}),
      makeSku("RV-QLP","Quiet Luxury Praline","Bon-bons",9,1299,"Pistachio–rose gianduja under a dark veil; hand-painted.",bonSet(),{ingredients:"Pistachio, cacao, sugar, rose.",story:"A small ceremony in every piece."}),
      makeSku("RV-SCB","Serenity Citrus Bark","Barks",200,849,"Candied orange peel + toasted almond in 68% dark.",barkSet(),{ingredients:"Cacao mass, candied orange, almond, sugar.",story:"Sunset in shards."}),
      makeSku("RV-MBD","Moon-Bath Dragees","Dragees",180,799,"Vanilla–sea-salt cashews, slow-snack double coat.",nutSet(),{ingredients:"Cashew, vanilla, sea salt, chocolate.",story:"Mindful, one by one."}),
      makeSku("RV-SUN","Sunday Morning Hand-Scooped","Hand-Scooped Bar",70,719,"Mascarpone cream • marmalade gel • almond praline.",heroSet(),{ingredients:"Milk chocolate, cream, almonds, marmalade.",story:"Slow radio, slower bites."}),
    ]
  },
];
*/

    function buildNarrative(p){
      const base = p.story || p.blurb || "Crafted in small batches with clean ingredients.";
      return `${base} Tempered to a crisp snap and wrapped fresh.`;
    }

    function App(){
      // Load collections and products from Supabase
      const { collections: COLLECTIONS, loading: collectionsLoading, error: collectionsError } = useSupabaseCollections();
      
      // ALL HOOKS MUST BE CALLED BEFORE ANY CONDITIONAL RETURNS
      const [route, setRoute] = useState({page:"home", param:null});
      const navigate = useHashNavigation(route, setRoute);
      const [search, setSearch] = useState("");
      const [cart, setCart] = useState([]);
      const [cartOpen, setCartOpen] = useState(false);
      const [checkoutOpen, setCheckoutOpen] = useState(false);
      const [cartFromCheckout, setCartFromCheckout] = useState(false);
      const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
      const [collectionsDropdown, setCollectionsDropdown] = useState(false);
      const [waNumber] = useState("919103109407");
      const [customer, setCustomer] = useState({ name:"", email:"", phone:"", address:"" });

      const ALL_PRODUCTS = useMemo(()=>(
        (COLLECTIONS || []).flatMap(c => c.products.map(p => ({...p, collection:c.key, collectionName:c.name})))
      ), [COLLECTIONS]);

      const cartCount = useMemo(()=> cart.reduce((a,c)=>a+c.qty,0), [cart]);
      const cartTotal = useMemo(()=> cart.reduce((s,l)=>{ const p=ALL_PRODUCTS.find(x=>x.sku===l.sku); return s + (p?p.price*l.qty:0); },0), [cart, ALL_PRODUCTS]);

      const filtered = useMemo(()=>{
        const q = (search||"").toLowerCase().trim();
        if (!q) return ALL_PRODUCTS;
        return ALL_PRODUCTS.filter(p => [p.name,p.type,p.collectionName,p.blurb].some(t=>t.toLowerCase().includes(q)));
      }, [search, ALL_PRODUCTS]);

      useEffect(() => {
        if (cartOpen && !cartFromCheckout) {
          window.history.pushState({ cart: true }, '');
        }
        
        if (cartOpen) {
          const handleCartBack = (e) => {
            setCartOpen(false);
            setCartFromCheckout(false);
          };
          
          window.addEventListener('popstate', handleCartBack);
          return () => {
            window.removeEventListener('popstate', handleCartBack);
            if (cartFromCheckout) {
              setCartFromCheckout(false);
            }
          };
        }
      }, [cartOpen, cartFromCheckout]);

      useEffect(() => {
        if (checkoutOpen) {
          window.history.pushState({ checkout: true }, '');
          
          const handleCheckoutBack = (e) => {
            setCheckoutOpen(false);
            setCartOpen(true);
            setCartFromCheckout(true);
          };
          
          window.addEventListener('popstate', handleCheckoutBack);
          return () => window.removeEventListener('popstate', handleCheckoutBack);
        }
      }, [checkoutOpen]);

      // NOW check for loading/error states AFTER all hooks are called
      // Show loading state while data loads
      if (collectionsLoading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-center">
              <div className="loading-spinner inline-block w-12 h-12 border-4 border-zinc-300 border-t-black rounded-full"></div>
              <p className="mt-4 text-zinc-600 font-logo">Loading LÈVORE...</p>
            </div>
          </div>
        );
      }

      // Show demo mode banner if there's an error but we have fallback products
      const showDemoBanner = collectionsError && collections && collections.length > 0;
      
      // Only show full error screen if there are NO products at all
      if (collectionsError && (!collections || collections.length === 0)) {
        return (
          <div className="min-h-screen flex items-center justify-center px-4">
            <div className="text-center max-w-md">
              <p className="text-red-600 font-semibold mb-2">Unable to load products</p>
              <p className="text-sm text-zinc-600 mb-4">{collectionsError}</p>
              <button onClick={() => window.location.reload()} className="px-6 py-2 bg-black text-white rounded-xl">
                Retry
              </button>
            </div>
          </div>
        );
      }

      function go(page,param=null){ 
  navigate(page, param);
  setMobileMenuOpen(false);
  setCollectionsDropdown(false);
}

function goAndScroll(page, param = null) {
  // Immediately scroll before navigation
  document.documentElement.scrollTop = 0;
  document.body.scrollTop = 0;
  
  // Navigate
  navigate(page, param);
  setMobileMenuOpen(false);
  setCollectionsDropdown(false);
  
  // Force scroll multiple times with delays
  requestAnimationFrame(() => {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
  });
  
  setTimeout(() => {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    window.scrollTo({ top: 0, behavior: 'instant' });
  }, 10);
  
  setTimeout(() => {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    window.scrollTo({ top: 0, behavior: 'instant' });
  }, 50);
  
  setTimeout(() => {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    window.scrollTo({ top: 0, behavior: 'instant' });
  }, 100);
}

      function goBack(){
        window.history.back();
      }

      function addToCart(sku, qty = 1){ 
        setCart(prev=>{ 
          const i=prev.findIndex(x=>x.sku===sku); 
          if(i>-1){ 
            const n=[...prev]; 
            n[i]={...n[i], qty:n[i].qty+qty}; 
            return n; 
          } 
          return [...prev, {sku, qty}]; 
        }); 
      }
      
      function updateQty(sku,delta){ setCart(prev=> prev.map(x=> x.sku===sku ? {...x, qty:Math.max(1, x.qty+delta)} : x)); }
      function removeItem(sku){ setCart(prev=> prev.filter(x=> x.sku!==sku)); }
      function clearCart(){ setCart([]); }
      
      function pdp(p){ 
  go("product", p.sku);
}
      
      function whatsappCheckout(){
        const lines = cart.map(x=>{ const p=ALL_PRODUCTS.find(i=>i.sku===x.sku); return `• ${p?.name} × ${x.qty} = ₹${(p?.price||0)*x.qty}`; }).join("%0A");
        const msg = `Hello LÈVORE,%0AI'd like to order:%0A${lines}%0ATotal: ₹${cartTotal}%0AName:${customer.name}%0APhone:${customer.phone}%0AAddress:${encodeURIComponent(customer.address)}`;
        window.open(`https://wa.me/${waNumber}?text=${msg}`,"_blank");
      }

      
      return (
  <div className="flex flex-col flex-1 bg-white text-zinc-900">
          {/* Demo Mode Banner - Shows when using fallback products */}
          {showDemoBanner && (
            <div className="fixed top-0 left-0 right-0 z-[60] bg-amber-100 border-b border-amber-200 px-4 py-2 text-center text-xs sm:text-sm">
              <span className="font-medium">⚠️ Demo Mode:</span> Showing sample products. 
              <button onClick={() => window.location.reload()} className="ml-2 underline font-medium hover:text-amber-900">
                Retry
              </button>
            </div>
          )}
          
          <header className={`fixed left-0 right-0 z-50 backdrop-blur bg-white/90 border-b border-zinc-200 shadow-sm ${showDemoBanner ? 'top-9' : 'top-0'}`}>
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
              <div className="md:hidden flex items-center justify-between w-full">
                <button onClick={()=>setMobileMenuOpen(!mobileMenuOpen)} className="text-2xl z-10">☰</button>
                <button onClick={()=>go("home")} className="font-logo text-2xl absolute left-1/2 -translate-x-1/2">LÈVORE</button>
                <button onClick={()=>setCartOpen(true)} className="relative rounded-2xl border p-2 hover:bg-zinc-100 z-10">
  <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
  </svg>
  {cartCount>0 && <span className="absolute -top-1 -right-1 inline-flex items-center justify-center text-xs bg-black text-white rounded-full w-5 h-5">{cartCount}</span>}
</button>
              </div>
              <button onClick={()=>go("home")} className="hidden md:block font-logo text-2xl">LÈVORE</button>
              <nav className="hidden md:flex gap-6 text-sm items-center">
                <button onClick={()=>go("shop")} className="hover:text-zinc-600">Shop</button>
                <div className="relative">
                  <button onMouseEnter={()=>setCollectionsDropdown(true)} onClick={()=>go("collections")} className="hover:text-zinc-600 flex items-center gap-1">
                    Collections <span className="text-xs">▾</span>
                  </button>
                  {collectionsDropdown && (
                    <div onMouseLeave={()=>setCollectionsDropdown(false)} className="absolute top-full left-0 mt-2 w-64 bg-white border rounded-xl shadow-lg py-2 max-h-96 overflow-y-auto">
                      {COLLECTIONS.map(c=>(
                        <button key={c.key} onClick={()=>go("collection",c.key)} className="block w-full text-left px-4 py-2 text-sm hover:bg-zinc-50">{c.name}</button>
                      ))}
                    </div>
                  )}
                </div>
                <button onClick={()=>go("story")} className="hover:text-zinc-600">Story</button>
                <button onClick={()=>go("gifting")} className="hover:text-zinc-600">Gifting</button>
                <button onClick={()=>go("faq")} className="hover:text-zinc-600">FAQ</button>
<button onClick={()=>go("quiz")} className="hover:text-zinc-600">Find Your Chocolate</button>
              </nav>
              <div className="hidden md:flex items-center gap-2">
                <div className="flex items-center rounded-2xl border px-3 py-1.5">
                  <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Search" className="text-sm outline-none bg-transparent w-32 lg:w-48"/>
                </div>
                <button onClick={()=>setCartOpen(true)} className="relative rounded-2xl border p-2.5 hover:bg-zinc-100">
  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
  </svg>
  {cartCount>0 && <span className="absolute -top-1 -right-1 inline-flex items-center justify-center text-xs bg-black text-white rounded-full w-5 h-5">{cartCount}</span>}
</button>
              </div>
            </div>
            {mobileMenuOpen && (
  <div className="md:hidden border-t bg-white">
    <nav className="flex flex-col p-4 space-y-3 text-sm">
      <button onClick={()=>go("account")} className="text-left hover:text-zinc-600 font-semibold">My Account</button>
      <button onClick={()=>go("track-order")} className="text-left hover:text-zinc-600 font-semibold">My Orders</button>
      <div className="border-t pt-3 mt-3"></div>
      <button onClick={()=>go("shop")} className="text-left hover:text-zinc-600">Shop</button>
      <div>
        <div className="font-semibold mb-2">Collections</div>
        <div className="pl-3 space-y-2">
          {COLLECTIONS.map(c=>(
            <button 
              key={c.key} 
              onClick={()=>go("collection",c.key)}
              className="block text-left hover:text-zinc-600 text-xs"
            >
              {c.name}
            </button>
          ))}
        </div>
      </div>
      <button onClick={()=>go("story")} className="text-left hover:text-zinc-600">Story</button>
      <button onClick={()=>go("gifting")} className="text-left hover:text-zinc-600">Gifting</button>
      <button onClick={()=>go("corporate")} className="text-left hover:text-zinc-600">Corporate Gifting</button>
      <button onClick={()=>go("quiz")} className="text-left hover:text-zinc-600">Chocolate Quiz</button>
      <button onClick={()=>go("faq")} className="text-left hover:text-zinc-600">FAQ</button>
    </nav>
  </div>
)}
          </header>

          <div className={`flex-1 ${showDemoBanner ? 'pt-[100px]' : 'pt-16'}`}>
            {route.page==="home" && <Home go={go} collections={COLLECTIONS}/>}
            {route.page==="collections" && (<><BackButton onClick={goBack}/><Collections collections={COLLECTIONS} onOpen={k=>go("collection",k)} /></>)}
            {route.page==="collection" && (<><BackButton onClick={goBack}/><CollectionView col={COLLECTIONS.find(c=>c.key===route.param)} onPdp={pdp} onAdd={s=>addToCart(s)} /></>)}
            {route.page==="shop" && (<><BackButton onClick={goBack}/><Shop products={filtered} onPdp={pdp} onAdd={s=>addToCart(s)} /></>)}
            {route.page==="story" && (<><BackButton onClick={goBack}/><Story/></>)}
            {route.page==="gifting" && (<><BackButton onClick={goBack}/><Gifting/></>)}
            {route.page==="faq" && (<><BackButton onClick={goBack}/><FAQ/></>)}
{route.page==="account" && (<><BackButton onClick={goBack}/><MyAccount/></>)}
{route.page==="track-order" && (<><BackButton onClick={goBack}/><TrackOrder/></>)}
{route.page==="contact" && (<><BackButton onClick={goBack}/><ContactUs/></>)}
{route.page==="quiz" && (<><BackButton onClick={goBack}/><ChocolateFinder go={go}/></>)}
{route.page==="reviews" && (<><BackButton onClick={goBack}/><Reviews/></>)}
{route.page==="subscription" && (<><BackButton onClick={goBack}/><Subscription/></>)}
{route.page==="corporate" && (<><BackButton onClick={goBack}/><CorporateGifting/></>)}
{route.page==="certifications" && (<><BackButton onClick={goBack}/><Certifications/></>)}
{route.page==="blog" && (<><BackButton onClick={goBack}/><Blog go={go}/></>)}
{route.page==="blog-post" && (<><BackButton onClick={goBack}/><BlogPost param={route.param}/></>)}
{route.page==="product" && (<><BackButton onClick={goBack}/><ProductPage product={ALL_PRODUCTS.find(p=>p.sku===route.param)} addToCart={addToCart} allProducts={ALL_PRODUCTS}/></>)}
{route.page==="privacy-policy" && (<><BackButton onClick={goBack}/><StaticPage slug="privacy-policy"/></>)}
{route.page==="terms-of-service" && (<><BackButton onClick={goBack}/><StaticPage slug="terms-of-service"/></>)}
{route.page==="shipping-policy" && (<><BackButton onClick={goBack}/><StaticPage slug="shipping-policy"/></>)}
            <Footer go={go} goAndScroll={goAndScroll}/>
          </div>

          
          <CartDrawer open={cartOpen} onClose={()=>setCartOpen(false)} cart={cart} products={ALL_PRODUCTS} total={cartTotal} onQty={updateQty} onRemove={removeItem} onCheckout={()=>{setCartOpen(false);setCheckoutOpen(true);}}/>
<CheckoutDrawer open={checkoutOpen} onClose={()=>setCheckoutOpen(false)} onBack={()=>{setCheckoutOpen(false);setCartOpen(true);}} cart={cart} products={ALL_PRODUCTS} total={cartTotal} onWhatsApp={whatsappCheckout} onRazorpay={()=>openRazorpayCheckout(cart, ALL_PRODUCTS, cartTotal, customer)} customer={customer} setCustomer={setCustomer}/>
        </div>
      );
    }

    function BackButton({ onClick }){
      return (<div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-6"><button onClick={onClick} className="flex items-center gap-2 text-sm text-zinc-600 hover:text-black"><span className="text-lg">←</span> Back</button></div>);
    }

    function Home({ go, collections }){
      const { heroSections, loading: heroLoading } = useHeroSections('home');
      const { sections: marketingSections, loading: sectionsLoading } = useMarketingSections('home');
      
      const hero = heroSections[0] || {};
      const differenceSection = marketingSections.difference || {};
      
      return (<>
        <div className="relative h-screen">
          <img src={hero.image_url || IMG.hero1} alt="Levore banner" className="w-full h-full object-cover"/>
          <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent"/>
          <div className="absolute inset-x-0 bottom-0 p-6 sm:p-16 text-white">
            <div className="max-w-4xl">
              <div className="text-xs uppercase tracking-[0.3em] mb-4 opacity-90">{hero.subtitle || 'LÈVORE · Bean-to-Bar Luxury'}</div>
              <h1 className="text-4xl sm:text-6xl lg:text-7xl font-light leading-tight mb-6" dangerouslySetInnerHTML={{__html: hero.title || 'Couture Chocolate,<br/><span class="font-serif italic">Woven in Fineness</span>'}}></h1>
              <p className="text-lg sm:text-xl mb-8 max-w-2xl opacity-90">{hero.description || 'From Andhra Pradesh cacao farms to your moment of indulgence — crafted with intention, refined to 18–20μm silk.'}</p>
              <div className="flex flex-wrap gap-4">
                {hero.cta_primary_text && (
                  <button 
                    onClick={()=>go(hero.cta_primary_link || "collections")} 
                    className="bg-white text-black px-8 py-4 rounded-full text-sm uppercase tracking-wider hover:bg-zinc-100 transition"
                  >
                    {hero.cta_primary_text}
                  </button>
                )}
                {!hero.cta_primary_text && (
                  <button 
                    onClick={()=>go("collections")} 
                    className="bg-white text-black px-8 py-4 rounded-full text-sm uppercase tracking-wider hover:bg-zinc-100 transition"
                  >
                    Explore Collections
                  </button>
                )}
                {hero.cta_secondary_text && (
                  <button 
                    onClick={()=>go(hero.cta_secondary_link || "quiz")} 
                    className="border-2 border-white text-white px-8 py-4 rounded-full text-sm uppercase tracking-wider hover:bg-white hover:text-black transition"
                  >
                    {hero.cta_secondary_text}
                  </button>
                )}
                {!hero.cta_secondary_text && (
                  <button 
                    onClick={()=>go("quiz")} 
                    className="border-2 border-white text-white px-8 py-4 rounded-full text-sm uppercase tracking-wider hover:bg-white hover:text-black transition"
                  >
                    Chocolate Quiz
                  </button>
                )}
              </div>
            </div>
          </div>
        </div>
        <section className="py-16 bg-white">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="text-center mb-12">
              <p className="text-xs uppercase tracking-[0.25em] text-amber-600 mb-2">11 Curated Worlds</p>
              <h2 className="text-3xl md:text-4xl font-light mb-4">Shop by Collection</h2>
              <p className="text-zinc-600 max-w-2xl mx-auto">Each collection tells a story — find yours</p>
            </div>
            <div className="md:hidden overflow-x-auto hide-scrollbar -mx-4 px-4">
              <div className="flex gap-4 pb-4">
                {collections.map(c => (
  <button key={c.key} onClick={() => go("collection", c.key)} className="flex-shrink-0 w-64 group">
    <div className="relative overflow-hidden rounded-2xl aspect-[3/4] mb-3">
      <img src={c.products[0].img} alt={c.name} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"/>
      <div className={`absolute inset-0 bg-gradient-to-t ${c.color} mix-blend-overlay opacity-30`}></div>
    </div>
    <h3 className="font-semibold text-left text-base mb-2">{c.name}</h3>
    <p className="text-sm text-zinc-600 text-left line-clamp-2">{c.tagline}</p>
  </button>
))}}
              </div>
            </div>
            <div className="hidden md:block relative">
  <button onClick={(e)=>{e.currentTarget.nextElementSibling.scrollBy({left:-300,behavior:'smooth'})}} className="absolute left-0 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full bg-white border-2 border-zinc-200 shadow-lg flex items-center justify-center hover:bg-zinc-50 transition">
    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7"/></svg>
  </button>
  <div className="overflow-x-auto hide-scrollbar -mx-4 px-4 scroll-smooth">
    <div className="flex gap-6 pb-4">
      {collections.map(c => (
        <button key={c.key} onClick={() => go("collection", c.key)} className="flex-shrink-0 w-64 group text-left">
          <div className="relative overflow-hidden rounded-2xl aspect-[3/4] mb-3">
            <img src={c.products[0].img} alt={c.name} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"/>
            <div className={`absolute inset-0 bg-gradient-to-t ${c.color} mix-blend-overlay opacity-30`}></div>
          </div>
          <h3 className="font-semibold text-base mb-2">{c.name}</h3>
          <p className="text-sm text-zinc-600 line-clamp-2">{c.tagline}</p>
        </button>
      ))}
    </div>
  </div>
  <button onClick={(e)=>{e.currentTarget.previousElementSibling.scrollBy({left:300,behavior:'smooth'})}} className="absolute right-0 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full bg-white border-2 border-zinc-200 shadow-lg flex items-center justify-center hover:bg-zinc-50 transition">
    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7"/></svg>
  </button>
</div>
          </div>
        </section>
        <section className="py-20 bg-zinc-50">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="text-center mb-16">
              <h3 className="text-3xl md:text-4xl font-light mb-4">{differenceSection.title || 'The LÈVORE Difference'}</h3>
              <p className="text-zinc-600 max-w-2xl mx-auto">{differenceSection.subtitle || 'Four principles that transform cacao into an experience'}</p>
            </div>
            <div className="grid sm:grid-cols-2 lg:grid-cols-4 gap-8">
              {(differenceSection.content || [
                {img:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?q=80&w=800&auto=format&fit=crop",title:"Bean → Bar",description:"Direct relationships with Andhra cacao farmers. We know every bean's journey."},
                {img:"https://images.unsplash.com/photo-1606857521015-7f9fcf423740?q=80&w=800&auto=format&fit=crop",title:"18–20μm Refinement",description:"Silk-smooth texture that melts like velvet. Science meets sensory art."},
                {img:"https://images.unsplash.com/photo-1481391319762-47dff72954d9?q=80&w=800&auto=format&fit=crop",title:"Clean Label Promise",description:"Cacao, cocoa butter, sugar. That's it. No shortcuts, no compromises."},
                {img:"https://images.unsplash.com/photo-1579372786545-d24232daf58c?q=80&w=800&auto=format&fit=crop",title:"Hand-Crafted Batches",description:"Small lots, perfect temper, wrapped like the luxury you deserve."}
              ]).map((f,i)=>(
                <div key={i} className="group">
                  <div className="overflow-hidden rounded-2xl mb-4 h-48">
                    <img src={f.img} alt={f.title} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"/>
                  </div>
                  <h4 className="text-lg font-semibold mb-2">{f.title}</h4>
                  <p className="text-sm text-zinc-600 leading-relaxed">{f.description}</p>
                </div>
              ))}
            </div>
          </div>
        </section>
        <section className="py-20 bg-white">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="grid md:grid-cols-2 gap-12 items-center">
              <div><img src="https://images.unsplash.com/photo-1511018556340-d16986a1c194?q=80&w=1600&auto=format&fit=crop" alt="Artisan chocolate making" className="w-full h-[500px] object-cover rounded-3xl shadow-2xl"/></div>
              <div className="space-y-6">
                <p className="text-xs uppercase tracking-[0.25em] text-amber-600">Your Daily Ritual, Elevated</p>
                <h3 className="text-3xl md:text-4xl font-light leading-tight">The chocolate in your hand tells a story</h3>
                <p className="text-zinc-600 leading-relaxed">From the cacao farms of Andhra Pradesh to your moment of pause—each bar is a testament to patience, precision, and the pursuit of perfection. We don't chase trends. We set standards.</p>
                <button onClick={()=>go("story")} className="text-sm uppercase tracking-wider border-b-2 border-black pb-1 hover:text-zinc-600 transition">Read Our Story →</button>
              </div>
            </div>
          </div>
        </section>
        <section className="py-16 bg-zinc-900 text-white">
          <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="text-center mb-12">
              <h3 className="text-2xl font-light mb-4">Trusted by India's Discerning Few</h3>
            </div>
            <div className="grid sm:grid-cols-3 gap-8 text-center">
              <div><div className="text-4xl font-light mb-2">100%</div><div className="text-sm text-zinc-400 uppercase tracking-wider">Vegetarian · Clean Label</div></div>
              <div><div className="text-4xl font-light mb-2">6 Months</div><div className="text-sm text-zinc-400 uppercase tracking-wider">Peak Freshness Guarantee</div></div>
              <div><div className="text-4xl font-light mb-2">22 SKUs</div><div className="text-sm text-zinc-400 uppercase tracking-wider">Across 11 Collections</div></div>
            </div>
          </div>
        </section>
<section className="py-20 bg-white">
  <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div className="grid md:grid-cols-2 gap-12 items-center">
      <div className="space-y-6">
        <p className="text-xs uppercase tracking-[0.25em] text-amber-600">The Art of Gifting</p>
        <h3 className="text-3xl md:text-4xl font-light leading-tight">Make every occasion unforgettable</h3>
        <p className="text-zinc-600 leading-relaxed">From corporate gestures to intimate celebrations, LÈVORE transforms moments into memories. Each box arrives gift-ready with personalized notes, premium wrapping, and the unmistakable weight of luxury.</p>
        <ul className="space-y-3 text-zinc-600">
          <li className="flex items-start gap-3"><span className="text-amber-600 mt-1">✦</span><span>Custom gift sets curated to your budget</span></li>
          <li className="flex items-start gap-3"><span className="text-amber-600 mt-1">✦</span><span>Personalized message cards</span></li>
          <li className="flex items-start gap-3"><span className="text-amber-600 mt-1">✦</span><span>Same-day delivery in metro cities</span></li>
        </ul>
        <button onClick={()=>go("gifting")} className="text-sm uppercase tracking-wider border-b-2 border-black pb-1 hover:text-zinc-600 transition">Explore Gifting →</button>
      </div>
      <div>
        <img src="https://images.unsplash.com/photo-1549887534-1541e9326642?q=80&w=1600&auto=format&fit=crop" alt="Luxury gift box" className="w-full h-[500px] object-cover rounded-3xl shadow-2xl"/>
      </div>
    </div>
  </div>
</section>

<section className="py-16 bg-zinc-50">
  <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div className="text-center mb-12">
      <h3 className="text-3xl md:text-4xl font-light mb-6">What Our Patrons Say</h3>
    </div>
    <div className="grid md:grid-cols-3 gap-8">
      {[
        {name: "Priya Sharma", role: "Creative Director", text: "LÈVORE isn't just chocolate—it's an experience. The attention to detail, from bean selection to packaging, is unmatched."},
        {name: "Arjun Mehta", role: "Entrepreneur", text: "I've gifted LÈVORE to international clients. The response? Always impressed. It represents Indian craftsmanship at its finest."},
        {name: "Kavita Desai", role: "Luxury Consultant", text: "Finally, a chocolate brand that understands quiet luxury. No loud branding, just exceptional quality that speaks for itself."}
      ].map((t, i) => (
        <div key={i} className="bg-white rounded-2xl p-8 border">
          <div className="text-amber-600 text-3xl mb-4">"</div>
          <p className="text-zinc-600 italic mb-6 leading-relaxed">{t.text}</p>
          <div className="border-t pt-4">
            <div className="font-semibold text-sm">{t.name}</div>
            <div className="text-xs text-zinc-500">{t.role}</div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
        <section className="py-20 bg-gradient-to-b from-amber-50 to-white">
          <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h3 className="text-3xl md:text-4xl font-light mb-6">Curated for the way you live</h3>
            <p className="text-lg text-zinc-600 mb-8 max-w-2xl mx-auto">Whether you're celebrating milestones, seeking quiet indulgence, or gifting with intention—we've crafted a collection that speaks to every facet of your refined life.</p>
            <div className="flex flex-wrap justify-center gap-4">
              <button onClick={()=>go("collections")} className="bg-black text-white px-8 py-4 rounded-full text-sm uppercase tracking-wider hover:bg-zinc-800 transition">Discover Your Collection</button>
              <button onClick={()=>go("gifting")} className="border-2 border-black text-black px-8 py-4 rounded-full text-sm uppercase tracking-wider hover:bg-black hover:text-white transition">Gift with Intention</button>
            </div>
          </div>
        </section>
      </>);
    }

    function Collections({ collections, onOpen }){
      return (<section className="py-20 bg-white">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="text-center mb-16">
            <p className="text-xs uppercase tracking-[0.25em] text-zinc-500 mb-4">11 Curated Worlds</p>
            <h2 className="text-4xl md:text-5xl font-light mb-6">Find Your Story</h2>
          </div>
          <div className="space-y-16">
            {collections.map((c, idx)=>(
              <button key={c.key} onClick={()=>onOpen(c.key)} className={`group ${idx % 2 === 0 ? '' : 'md:flex-row-reverse'} flex flex-col md:flex-row gap-8 items-center text-left w-full`}>
  <div className="w-full md:w-1/2">
    <div className="relative overflow-hidden rounded-3xl aspect-[4/3]">
      <img src={c.products[0].img} alt={c.name} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"/>
      <div className={`absolute inset-0 bg-gradient-to-br ${c.color} mix-blend-overlay opacity-40`}></div>
    </div>
  </div>
  <div className="w-full md:w-1/2 space-y-6">
    <div>
      <p className="text-xs uppercase tracking-[0.25em] text-amber-600 mb-2">{c.tagline}</p>
      <h3 className="text-3xl md:text-4xl font-light mb-4">{c.name}</h3>
      <p className="text-zinc-600 leading-relaxed">{c.story}</p>
    </div>
    <div className="inline-flex items-center gap-2 text-sm uppercase tracking-wider border-b-2 border-black pb-1 group-hover:text-zinc-600 transition group-hover:gap-4">
      Explore Collection <span className="transition-transform group-hover:translate-x-1">→</span>
    </div>
  </div>
</button>
            ))}
          </div>
        </div>
      </section>);
    }

    function CollectionView({ col, onPdp, onAdd }){
      if(!col) return null;
      return (<section className="py-12"><div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div><h2 className="text-3xl font-bold">{col.name}</h2><p className="text-sm text-zinc-600 mt-2">{col.story}</p></div><div className="mt-8 grid sm:grid-cols-2 lg:grid-cols-3 gap-6">{col.products.map(p=>(<Card key={p.sku} p={p} onPdp={()=>onPdp({...p, collection:col.key, collectionName:col.name})} onAdd={()=>onAdd(p.sku)}/>))}</div></div></section>);
    }

    function Shop({ products, onPdp, onAdd }){
      const [sortBy, setSortBy] = useState("name-asc");
      const [filterCollection, setFilterCollection] = useState("all");
      const [filterType, setFilterType] = useState("all");
      const [priceRange, setPriceRange] = useState("all");
      const [showFilters, setShowFilters] = useState(false);

      // Get unique collections and types
      const collections = useMemo(() => {
        const unique = [...new Set(products.map(p => p.collectionName))].filter(Boolean);
        return unique.sort();
      }, [products]);

      const types = useMemo(() => {
        const unique = [...new Set(products.map(p => p.type))].filter(Boolean);
        return unique.sort();
      }, [products]);

      // Filter products
      const filteredProducts = useMemo(() => {
        let filtered = [...products];

        // Filter by collection
        if (filterCollection !== "all") {
          filtered = filtered.filter(p => p.collectionName === filterCollection);
        }

        // Filter by type
        if (filterType !== "all") {
          filtered = filtered.filter(p => p.type === filterType);
        }

        // Filter by price range
        if (priceRange !== "all") {
          filtered = filtered.filter(p => {
            const price = p.price;
            if (priceRange === "under-500") return price < 500;
            if (priceRange === "500-1000") return price >= 500 && price < 1000;
            if (priceRange === "1000-2000") return price >= 1000 && price < 2000;
            if (priceRange === "above-2000") return price >= 2000;
            return true;
          });
        }

        return filtered;
      }, [products, filterCollection, filterType, priceRange]);

      // Sort products
      const sortedProducts = useMemo(() => {
        const sorted = [...filteredProducts];

        switch(sortBy) {
          case "price-asc":
            return sorted.sort((a, b) => a.price - b.price);
          case "price-desc":
            return sorted.sort((a, b) => b.price - a.price);
          case "name-asc":
            return sorted.sort((a, b) => a.name.localeCompare(b.name));
          case "name-desc":
            return sorted.sort((a, b) => b.name.localeCompare(a.name));
          default:
            return sorted;
        }
      }, [filteredProducts, sortBy]);

      // Clear all filters
      const clearFilters = () => {
        setFilterCollection("all");
        setFilterType("all");
        setPriceRange("all");
        setSortBy("name-asc");
      };

      const hasActiveFilters = filterCollection !== "all" || filterType !== "all" || priceRange !== "all";

      return (
        <section className="py-12 bg-white min-h-screen">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            {/* Header */}
            <div className="flex items-center justify-between mb-8">
              <div>
                <h2 className="text-3xl md:text-4xl font-light mb-2">Shop All</h2>
                <p className="text-sm text-zinc-600">
                  {sortedProducts.length} {sortedProducts.length === 1 ? 'product' : 'products'}
                  {hasActiveFilters && ` (filtered from ${products.length})`}
                </p>
              </div>
              <button 
                onClick={() => setShowFilters(!showFilters)} 
                className="md:hidden rounded-xl border-2 border-black px-4 py-2 text-sm font-medium"
              >
                {showFilters ? 'Hide Filters' : 'Show Filters'}
              </button>
            </div>

            <div className="grid md:grid-cols-4 gap-8">
              {/* Filters Sidebar */}
              <div className={`md:col-span-1 ${showFilters ? 'block' : 'hidden md:block'}`}>
                <div className="sticky top-4 space-y-6">
                  {/* Filter Header */}
                  <div className="flex items-center justify-between">
                    <h3 className="font-semibold text-lg">Filters</h3>
                    {hasActiveFilters && (
                      <button onClick={clearFilters} className="text-sm text-zinc-600 hover:text-black underline">
                        Clear all
                      </button>
                    )}
                  </div>

                  {/* Sort By */}
                  <div className="border-b pb-6">
                    <label className="block text-sm font-medium mb-3">Sort By</label>
                    <select 
                      value={sortBy} 
                      onChange={(e) => setSortBy(e.target.value)}
                      className="w-full rounded-xl border-2 px-3 py-2 text-sm outline-none focus:border-black"
                    >
                      <option value="name-asc">Name (A-Z)</option>
                      <option value="name-desc">Name (Z-A)</option>
                      <option value="price-asc">Price (Low to High)</option>
                      <option value="price-desc">Price (High to Low)</option>
                    </select>
                  </div>

                  {/* Collection Filter */}
                  {collections.length > 0 && (
                    <div className="border-b pb-6">
                      <label className="block text-sm font-medium mb-3">Collection</label>
                      <div className="space-y-2">
                        <label className="flex items-center gap-2 cursor-pointer">
                          <input 
                            type="radio" 
                            name="collection" 
                            value="all"
                            checked={filterCollection === "all"}
                            onChange={(e) => setFilterCollection(e.target.value)}
                            className="w-4 h-4"
                          />
                          <span className="text-sm">All Collections</span>
                        </label>
                        {collections.map(collection => (
                          <label key={collection} className="flex items-center gap-2 cursor-pointer">
                            <input 
                              type="radio" 
                              name="collection" 
                              value={collection}
                              checked={filterCollection === collection}
                              onChange={(e) => setFilterCollection(e.target.value)}
                              className="w-4 h-4"
                            />
                            <span className="text-sm">{collection}</span>
                          </label>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Type Filter */}
                  {types.length > 0 && (
                    <div className="border-b pb-6">
                      <label className="block text-sm font-medium mb-3">Type</label>
                      <div className="space-y-2">
                        <label className="flex items-center gap-2 cursor-pointer">
                          <input 
                            type="radio" 
                            name="type" 
                            value="all"
                            checked={filterType === "all"}
                            onChange={(e) => setFilterType(e.target.value)}
                            className="w-4 h-4"
                          />
                          <span className="text-sm">All Types</span>
                        </label>
                        {types.map(type => (
                          <label key={type} className="flex items-center gap-2 cursor-pointer">
                            <input 
                              type="radio" 
                              name="type" 
                              value={type}
                              checked={filterType === type}
                              onChange={(e) => setFilterType(e.target.value)}
                              className="w-4 h-4"
                            />
                            <span className="text-sm">{type}</span>
                          </label>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Price Range Filter */}
                  <div className="pb-6">
                    <label className="block text-sm font-medium mb-3">Price Range</label>
                    <div className="space-y-2">
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input 
                          type="radio" 
                          name="price" 
                          value="all"
                          checked={priceRange === "all"}
                          onChange={(e) => setPriceRange(e.target.value)}
                          className="w-4 h-4"
                        />
                        <span className="text-sm">All Prices</span>
                      </label>
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input 
                          type="radio" 
                          name="price" 
                          value="under-500"
                          checked={priceRange === "under-500"}
                          onChange={(e) => setPriceRange(e.target.value)}
                          className="w-4 h-4"
                        />
                        <span className="text-sm">Under ₹500</span>
                      </label>
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input 
                          type="radio" 
                          name="price" 
                          value="500-1000"
                          checked={priceRange === "500-1000"}
                          onChange={(e) => setPriceRange(e.target.value)}
                          className="w-4 h-4"
                        />
                        <span className="text-sm">₹500 - ₹1,000</span>
                      </label>
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input 
                          type="radio" 
                          name="price" 
                          value="1000-2000"
                          checked={priceRange === "1000-2000"}
                          onChange={(e) => setPriceRange(e.target.value)}
                          className="w-4 h-4"
                        />
                        <span className="text-sm">₹1,000 - ₹2,000</span>
                      </label>
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input 
                          type="radio" 
                          name="price" 
                          value="above-2000"
                          checked={priceRange === "above-2000"}
                          onChange={(e) => setPriceRange(e.target.value)}
                          className="w-4 h-4"
                        />
                        <span className="text-sm">Above ₹2,000</span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              {/* Products Grid */}
              <div className="md:col-span-3">
                {sortedProducts.length === 0 ? (
                  <div className="text-center py-16">
                    <div className="text-5xl mb-4">🔍</div>
                    <h3 className="text-xl font-semibold mb-2">No products found</h3>
                    <p className="text-zinc-600 mb-6">Try adjusting your filters</p>
                    <button onClick={clearFilters} className="rounded-xl bg-black text-white px-6 py-3 text-sm">
                      Clear Filters
                    </button>
                  </div>
                ) : (
                  <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    {sortedProducts.map(p => (
                      <Card key={p.sku} p={p} onPdp={() => onPdp(p)} onAdd={() => onAdd(p.sku)} />
                    ))}
                  </div>
                )}
              </div>
            </div>
          </div>
        </section>
      );
    }

    function Card({ p, onPdp, onAdd }){
  return (<div className="group rounded-3xl overflow-hidden border bg-zinc-50 hover:shadow-xl transition cursor-pointer" onClick={onPdp}><div className="aspect-[4/3] overflow-hidden"><img alt={p.name} src={p.img} className="w-full h-full object-cover group-hover:scale-105 transition-transform"/></div><div className="p-5"><div className="text-xs uppercase tracking-wider text-zinc-500">{p.type}</div><div className="font-semibold text-base">{p.name}</div><p className="text-sm text-zinc-600 mt-1 line-clamp-2">{p.blurb}</p><div className="mt-3 flex items-center justify-between"><span className="text-sm font-medium">₹{p.price}</span><div className="flex gap-2"><button onClick={(e)=>{e.stopPropagation();onAdd();}} className="rounded-xl border px-3 py-2 text-xs hover:bg-zinc-100">Add</button><button onClick={(e)=>{e.stopPropagation();onPdp();}} className="rounded-xl bg-black text-white px-3 py-2 text-xs">View</button></div></div></div></div>);
}

    function Story(){
      const { storyContent, loading } = useStoryContent();
      
      if (loading) {
        return (
          <div className="py-16 flex justify-center">
            <div className="loading-spinner"></div>
          </div>
        );
      }
      
      return (
        <div className="py-16 bg-white">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="text-center mb-16">
              <h2 className="text-4xl md:text-5xl font-light mb-4">Our Story</h2>
              <p className="text-zinc-600 max-w-2xl mx-auto">Crafted with passion, refined to perfection</p>
            </div>
            
            {storyContent.length === 0 ? (
              <div className="text-center py-12">
                <p className="text-zinc-600">Story content coming soon...</p>
              </div>
            ) : (
              <div className="space-y-20">
                {storyContent.map((section, idx) => (
                  <div key={section.id} className={`grid md:grid-cols-2 gap-12 items-center ${idx % 2 === 1 ? 'md:flex-row-reverse' : ''}`}>
                    {idx % 2 === 0 ? (
                      <>
                        <div>
                          {section.image_url && (
                            <img src={section.image_url} alt={section.title} className="w-full h-[400px] object-cover rounded-3xl shadow-lg"/>
                          )}
                        </div>
                        <div>
                          <h3 className="text-3xl font-light mb-4">{section.title}</h3>
                          <p className="text-zinc-600 leading-relaxed whitespace-pre-line">{getContentText(section.content)}</p>
                        </div>
                      </>
                    ) : (
                      <>
                        <div>
                          <h3 className="text-3xl font-light mb-4">{section.title}</h3>
                          <p className="text-zinc-600 leading-relaxed whitespace-pre-line">{getContentText(section.content)}</p>
                        </div>
                        <div>
                          {section.image_url && (
                            <img src={section.image_url} alt={section.title} className="w-full h-[400px] object-cover rounded-3xl shadow-lg"/>
                          )}
                        </div>
                      </>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    }

    function Gifting(){
      const { giftingContent, loading } = useGiftingContent();
      
      if (loading) {
        return (
          <div className="py-16 flex justify-center">
            <div className="loading-spinner"></div>
          </div>
        );
      }
      
      const heroSection = giftingContent.find(s => s.section_key === 'hero');
      
      return (
        <div className="py-16 bg-white">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            {heroSection ? (
              <div className="grid md:grid-cols-2 gap-12 items-center mb-16">
                <div className="space-y-6">
                  <p className="text-xs uppercase tracking-[0.25em] text-amber-600">The Art of Gifting</p>
                  <h2 className="text-3xl md:text-4xl font-light leading-tight">{heroSection.title}</h2>
                  <p className="text-zinc-600 leading-relaxed">{heroSection.description}</p>
                  {heroSection.features && Array.isArray(heroSection.features) && (
                    <ul className="space-y-3 text-zinc-600">
                      {heroSection.features.map((feature, idx) => (
                        <li key={idx} className="flex items-start gap-3">
                          <span className="text-amber-600 mt-1">{feature.icon || '✦'}</span>
                          <span>{feature.text}</span>
                        </li>
                      ))}
                    </ul>
                  )}
                </div>
                <div>
                  {heroSection.image_url && (
                    <img src={heroSection.image_url} alt="Luxury gift box" className="w-full h-[500px] object-cover rounded-3xl shadow-2xl"/>
                  )}
                </div>
              </div>
            ) : (
              <div className="text-center py-12">
                <h2 className="text-4xl font-light mb-4">Gifting</h2>
                <p className="text-zinc-600">Gifting options coming soon...</p>
              </div>
            )}
          </div>
        </div>
      );
    }

    function FAQ(){
      const { faqs, loading } = useFAQs();
      const [openIndex, setOpenIndex] = useState(null);
      
      if (loading) {
        return (
          <div className="py-16 flex justify-center">
            <div className="loading-spinner"></div>
          </div>
        );
      }
      
      // Group FAQs by category
      const faqsByCategory = faqs.reduce((acc, faq) => {
        const category = faq.category || 'General';
        if (!acc[category]) acc[category] = [];
        acc[category].push(faq);
        return acc;
      }, {});
      
      return (
        <section className="py-16 bg-white">
          <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="text-center mb-12">
              <h2 className="text-4xl md:text-5xl font-light mb-4">Frequently Asked Questions</h2>
              <p className="text-zinc-600">Everything you need to know about LÈVORE</p>
            </div>
            
            {Object.keys(faqsByCategory).length === 0 ? (
              <div className="text-center py-12">
                <p className="text-zinc-600">FAQs coming soon...</p>
              </div>
            ) : (
              <div className="space-y-12">
                {Object.entries(faqsByCategory).map(([category, categoryFaqs]) => (
                  <div key={category}>
                    <h3 className="text-2xl font-semibold mb-6 text-amber-600">{category}</h3>
                    <div className="space-y-4">
                      {categoryFaqs.map((faq, idx) => {
                        const faqIndex = `${category}-${idx}`;
                        const isOpen = openIndex === faqIndex;
                        return (
                          <div key={faq.id} className="rounded-2xl border bg-zinc-50 overflow-hidden">
                            <button
                              onClick={() => setOpenIndex(isOpen ? null : faqIndex)}
                              className="w-full text-left p-5 flex items-center justify-between hover:bg-zinc-100 transition"
                            >
                              <span className="font-semibold pr-4">{faq.question}</span>
                              <span className="text-2xl flex-shrink-0">{isOpen ? '−' : '+'}</span>
                            </button>
                            {isOpen && (
                              <div className="px-5 pb-5">
                                <p className="text-zinc-600 leading-relaxed">{faq.answer}</p>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        </section>
      );
    }

function MyAccount(){
  const [authMode, setAuthMode] = useState("login"); // login or signup
  const [authStep, setAuthStep] = useState("login"); // login or profile
  const [user, setUser] = useState(null);
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [name, setName] = useState("");
  const [activeTab, setActiveTab] = useState("profile");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");

  // Check if user is already logged in (from Supabase session)
  useEffect(() => {
    async function checkSession() {
      if (!supabase) return;
      
      const { data: { session } } = await supabase.auth.getSession();
      if (session?.user) {
        setUser({
          email: session.user.email,
          name: session.user.user_metadata?.name || session.user.email?.split('@')[0],
          picture: session.user.user_metadata?.picture || `https://ui-avatars.com/api/?name=${encodeURIComponent(session.user.email)}&background=000&color=fff`,
          id: session.user.id
        });
        setAuthStep("profile");
      }
    }
    checkSession();
  }, []);

  // Google Sign-In
  const handleGoogleSignIn = () => {
    if (typeof google === 'undefined' || !google.accounts) {
      alert("Google Sign-In is loading... Please try again in a moment.");
      return;
    }

    google.accounts.id.initialize({
      client_id: "455182232955-32e1agage03se75c57l3bufi5pbvasft.apps.googleusercontent.com",
      callback: async (response) => {
        try {
          const base64Url = response.credential.split('.')[1];
          const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
          const payload = JSON.parse(atob(base64));
          
          const googleUser = {
            email: payload.email,
            name: payload.name,
            picture: payload.picture,
            googleId: payload.sub,
            id: payload.sub
          };
          
          // Store user in Supabase Auth (optional - for tracking)
          if (supabase) {
            try {
              // You can optionally store this in a customers table
              await supabase.from('customers').upsert({
                email: googleUser.email,
                name: googleUser.name,
                auth_provider: 'google',
                google_id: googleUser.googleId
              }, { onConflict: 'email' });
            } catch (err) {
              console.log('Note: Could not store in customers table:', err.message);
            }
          }
          
          setUser(googleUser);
          setAuthStep("profile");
          
        } catch (error) {
          console.error("Google Sign-In error:", error);
          alert("Google Sign-In failed. Please try again.");
        }
      }
    });

    google.accounts.id.prompt((notification) => {
      if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
        console.log("One Tap not shown:", notification.getNotDisplayedReason());
      }
    });
  };

  // Email/Password Sign In
  const handleEmailSignIn = async (e) => {
    e.preventDefault();
    if (!email || !password) {
      setError("Please enter email and password");
      return;
    }

    setLoading(true);
    setError("");

    try {
      if (!supabase) {
        throw new Error("Supabase not initialized");
      }

      const { data, error: signInError } = await supabase.auth.signInWithPassword({
        email: email,
        password: password
      });

      if (signInError) throw signInError;

      if (data.user) {
        setUser({
          email: data.user.email,
          name: data.user.user_metadata?.name || data.user.email.split('@')[0],
          picture: data.user.user_metadata?.picture || `https://ui-avatars.com/api/?name=${encodeURIComponent(data.user.email)}&background=000&color=fff`,
          id: data.user.id
        });
        setAuthStep("profile");
      }
    } catch (err) {
      console.error("Sign in error:", err);
      setError(err.message || "Invalid email or password");
    } finally {
      setLoading(false);
    }
  };

  // Email/Password Sign Up
  const handleEmailSignUp = async (e) => {
    e.preventDefault();
    if (!email || !password || !name) {
      setError("Please fill in all fields");
      return;
    }

    if (password.length < 6) {
      setError("Password must be at least 6 characters");
      return;
    }

    setLoading(true);
    setError("");

    try {
      if (!supabase) {
        throw new Error("Supabase not initialized");
      }

      const { data, error: signUpError } = await supabase.auth.signUp({
        email: email,
        password: password,
        options: {
          data: {
            name: name
          }
        }
      });

      if (signUpError) throw signUpError;

      if (data.user) {
        // Check if email confirmation is required
        if (data.user.identities?.length === 0) {
          setError("An account with this email already exists. Please sign in instead.");
          setAuthMode("login");
        } else {
          setUser({
            email: data.user.email,
            name: name,
            picture: `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=000&color=fff`,
            id: data.user.id
          });
          setAuthStep("profile");
          alert("Account created successfully! Welcome to LÈVORE!");
        }
      }
    } catch (err) {
      console.error("Sign up error:", err);
      setError(err.message || "Failed to create account");
    } finally {
      setLoading(false);
    }
  };

  // Sign Out
  const handleSignOut = async () => {
    if (supabase) {
      await supabase.auth.signOut();
    }
    setUser(null);
    setAuthStep("login");
    setEmail("");
    setPassword("");
    setName("");
  };

  // Login/Signup Screen
  if(authStep === "login"){
    return (
      <section className="py-16 bg-white min-h-screen flex items-center justify-center">
        <div className="max-w-md w-full px-4">
          <div className="text-center mb-8">
            <div className="font-logo text-3xl mb-4">LÈVORE</div>
            <h2 className="text-2xl font-light mb-2">
              {authMode === "login" ? "Welcome Back" : "Create Account"}
            </h2>
            <p className="text-zinc-600 text-sm">
              {authMode === "login" ? "Sign in to access your account" : "Join the LÈVORE community"}
            </p>
          </div>
          
          <div className="bg-zinc-50 rounded-3xl p-8 border space-y-4">
            <button onClick={handleGoogleSignIn} className="w-full flex items-center justify-center gap-3 bg-white border-2 border-zinc-200 rounded-xl px-6 py-4 hover:border-zinc-300 transition">
              <svg className="w-5 h-5" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
              </svg>
              <span className="font-medium">Continue with Google</span>
            </button>

            <div className="relative">
              <div className="absolute inset-0 flex items-center">
                <div className="w-full border-t border-zinc-300"></div>
              </div>
              <div className="relative flex justify-center text-sm">
                <span className="px-4 bg-zinc-50 text-zinc-500">
                  {authMode === "login" ? "Or sign in with email" : "Or sign up with email"}
                </span>
              </div>
            </div>

            {error && (
              <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-xl text-sm">
                {error}
              </div>
            )}

            <form onSubmit={authMode === "login" ? handleEmailSignIn : handleEmailSignUp} className="space-y-3">
              {authMode === "signup" && (
                <input 
                  type="text" 
                  placeholder="Full Name" 
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  className="w-full rounded-xl border-2 px-4 py-3 outline-none focus:border-black transition"
                  required
                />
              )}
              <input 
                type="email" 
                placeholder="Email address" 
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="w-full rounded-xl border-2 px-4 py-3 outline-none focus:border-black transition"
                required
              />
              <input 
                type="password" 
                placeholder="Password" 
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="w-full rounded-xl border-2 px-4 py-3 outline-none focus:border-black transition"
                minLength="6"
                required
              />
              <button 
                type="submit"
                disabled={loading}
                className="w-full bg-black text-white rounded-xl py-3 font-medium hover:bg-zinc-800 transition disabled:bg-zinc-300 disabled:cursor-not-allowed"
              >
                {loading ? (
                  <><span className="loading-spinner"></span>Please wait...</>
                ) : (
                  authMode === "login" ? "Sign In" : "Create Account"
                )}
              </button>
            </form>

            <div className="text-center text-sm">
              {authMode === "login" ? (
                <>
                  <span className="text-zinc-600">Don't have an account? </span>
                  <button 
                    onClick={() => {setAuthMode("signup"); setError("");}} 
                    className="font-medium underline"
                  >
                    Create Account
                  </button>
                </>
              ) : (
                <>
                  <span className="text-zinc-600">Already have an account? </span>
                  <button 
                    onClick={() => {setAuthMode("login"); setError("");}} 
                    className="font-medium underline"
                  >
                    Sign In
                  </button>
                </>
              )}
            </div>
          </div>

          <p className="text-center text-xs text-zinc-500 mt-6">
            By continuing, you agree to our Terms of Service and Privacy Policy
          </p>
        </div>
      </section>
    );
  }

  // Profile Screen (after authentication)
  const tabs = [
    {id:"profile", label:"Profile", icon:"👤"},
    {id:"orders", label:"My Orders", icon:"📦"},
    {id:"addresses", label:"Addresses", icon:"📍"},
    {id:"wishlist", label:"Wishlist", icon:"❤️"},
  ];

  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* User Header */}
        <div className="flex items-center justify-between mb-8 pb-8 border-b">
          <div className="flex items-center gap-4">
            <img src={user.picture} alt={user.name} className="w-16 h-16 rounded-full border-2"/>
            <div>
              <h2 className="text-2xl font-light">{user.name}</h2>
              <p className="text-sm text-zinc-600">{user.email}</p>
            </div>
          </div>
          <button onClick={handleSignOut} className="text-sm text-zinc-600 hover:text-black border px-4 py-2 rounded-xl">
            Sign Out
          </button>
        </div>

        <div className="grid md:grid-cols-4 gap-8">
          {/* Sidebar Tabs */}
          <div className="md:col-span-1">
            <div className="space-y-2">
              {tabs.map(tab=>(
                <button 
                  key={tab.id} 
                  onClick={()=>setActiveTab(tab.id)}
                  className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition ${activeTab===tab.id?'bg-black text-white':'hover:bg-zinc-50'}`}
                >
                  <span className="text-xl">{tab.icon}</span>
                  <span>{tab.label}</span>
                </button>
              ))}
            </div>
          </div>

          {/* Content Area */}
          <div className="md:col-span-3">
            {activeTab === "profile" && (
              <div className="bg-zinc-50 rounded-3xl p-8 border">
                <h3 className="text-xl font-semibold mb-6">Profile Information</h3>
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium mb-2">Full Name</label>
                    <input value={user.name} onChange={e=>setUser({...user,name:e.target.value})} className="w-full rounded-xl border-2 px-4 py-3"/>
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-2">Email</label>
                    <input value={user.email} disabled className="w-full rounded-xl border-2 px-4 py-3 bg-zinc-100"/>
                  </div>
                  <button className="bg-black text-white rounded-xl px-6 py-3 font-medium hover:bg-zinc-800 transition">Save Changes</button>
                </div>
              </div>
            )}

            {activeTab === "orders" && (
              <div className="space-y-4">
                <h3 className="text-xl font-semibold mb-6">My Orders</h3>
                <div className="bg-zinc-50 rounded-3xl p-12 border text-center">
                  <div className="text-5xl mb-4">📦</div>
                  <p className="text-zinc-600">No orders yet</p>
                  <button onClick={()=>window.location.hash='shop'} className="mt-4 bg-black text-white rounded-xl px-6 py-3 text-sm">Start Shopping</button>
                </div>
              </div>
            )}

            {activeTab === "addresses" && (
              <div className="space-y-4">
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-xl font-semibold">Saved Addresses</h3>
                  <button className="text-sm border-2 border-black px-4 py-2 rounded-xl hover:bg-black hover:text-white transition">+ Add New</button>
                </div>
                <div className="bg-zinc-50 rounded-3xl p-12 border text-center">
                  <div className="text-5xl mb-4">📍</div>
                  <p className="text-zinc-600">No saved addresses</p>
                </div>
              </div>
            )}

            {activeTab === "wishlist" && (
              <div className="space-y-4">
                <h3 className="text-xl font-semibold mb-6">My Wishlist</h3>
                <div className="bg-zinc-50 rounded-3xl p-12 border text-center">
                  <div className="text-5xl mb-4">❤️</div>
                  <p className="text-zinc-600">Your wishlist is empty</p>
                  <button onClick={()=>window.location.hash='collections'} className="mt-4 bg-black text-white rounded-xl px-6 py-3 text-sm">Explore Collections</button>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </section>
  );
}
function TrackOrder(){
  const [orderId, setOrderId] = useState("");
  const [tracking, setTracking] = useState(null);
  
  const handleTrack = () => {
    if(orderId.trim()){
      setTracking({
        id: orderId,
        status: "In Transit",
        steps: [
          {label:"Order Placed", date:"Oct 25, 2025", done:true},
          {label:"Confirmed", date:"Oct 25, 2025", done:true},
          {label:"Shipped", date:"Oct 27, 2025", done:true},
          {label:"Out for Delivery", date:"Oct 29, 2025", done:false},
          {label:"Delivered", date:"", done:false},
        ]
      });
    }
  };

  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="text-center mb-8">
          <h2 className="text-3xl font-light mb-2">Track Your Order</h2>
          <p className="text-zinc-600">Enter your order ID to check status</p>
        </div>
        <div className="bg-zinc-50 rounded-3xl p-8 border">
          <div className="space-y-3 mb-8">
  <input value={orderId} onChange={e=>setOrderId(e.target.value)} placeholder="Order ID (e.g., LV-12345)" className="w-full rounded-xl border px-4 py-3"/>
  <button onClick={handleTrack} className="w-full bg-black text-white rounded-xl px-8 py-3 font-medium hover:bg-zinc-800 transition">Track Order</button>
</div>
          {tracking && (
            <div>
              <div className="mb-6 pb-6 border-b">
                <div className="flex justify-between items-center">
                  <div>
                    <div className="text-sm text-zinc-600">Order ID</div>
                    <div className="font-semibold">{tracking.id}</div>
                  </div>
                  <div className="text-right">
                    <div className="text-sm text-zinc-600">Status</div>
                    <div className="font-semibold text-amber-600">{tracking.status}</div>
                  </div>
                </div>
              </div>
              <div className="space-y-4">
                {tracking.steps.map((step,i)=>(
                  <div key={i} className="flex gap-4">
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center ${step.done?'bg-black text-white':'bg-zinc-200'}`}>
                      {step.done?'✓':'○'}
                    </div>
                    <div className="flex-1">
                      <div className={`font-medium ${step.done?'text-black':'text-zinc-400'}`}>{step.label}</div>
                      {step.date && <div className="text-sm text-zinc-500">{step.date}</div>}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </section>
  );
}

function ContactUs(){
  const { contactInfo, loading } = useContactInfo();
  
  if (loading) {
    return (
      <div className="py-16 flex justify-center">
        <div className="loading-spinner"></div>
      </div>
    );
  }
  
  const email = contactInfo.email?.value || 'hello@levore.in';
  const phone = contactInfo.phone?.value || '+91 91031 09407';
  const whatsapp = contactInfo.whatsapp?.value || '919103109407';
  
  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="text-center mb-12">
          <h2 className="text-3xl font-light mb-2">Get in Touch</h2>
          <p className="text-zinc-600">We'd love to hear from you</p>
        </div>
        <div className="grid md:grid-cols-2 gap-12">
          <div className="space-y-8">
            <div className="bg-zinc-50 rounded-3xl p-8 border">
              <div className="w-12 h-12 rounded-full bg-black text-white flex items-center justify-center mb-4">
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
              </div>
              <h3 className="font-semibold mb-2">{contactInfo.email?.label || 'Email Us'}</h3>
              <p className="text-zinc-600 text-sm mb-4">Our team responds within 24 hours</p>
              <a href={`mailto:${email}`} className="text-sm font-medium underline">{email}</a>
            </div>
            <div className="bg-zinc-50 rounded-3xl p-8 border">
              <div className="w-12 h-12 rounded-full bg-green-600 text-white flex items-center justify-center mb-4">
                <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
              </div>
              <h3 className="font-semibold mb-2">{contactInfo.whatsapp?.label || 'WhatsApp'}</h3>
              <p className="text-zinc-600 text-sm mb-4">Quick responses, 10 AM - 8 PM</p>
              <a href={`https://wa.me/${whatsapp}`} className="text-sm font-medium underline">{phone}</a>
            </div>
          </div>
          <div className="bg-zinc-50 rounded-3xl p-8 border">
            <h3 className="text-xl font-semibold mb-6">Send us a message</h3>
            <form className="space-y-4" onSubmit={e=>{e.preventDefault();alert("Message sent! We'll respond within 24 hours.");}}>
              <div>
                <label className="block text-sm font-medium mb-2">Name</label>
                <input required className="w-full rounded-xl border px-4 py-3" placeholder="Your name"/>
              </div>
              <div>
                <label className="block text-sm font-medium mb-2">Email</label>
                <input required type="email" className="w-full rounded-xl border px-4 py-3" placeholder="you@example.com"/>
              </div>
              <div>
                <label className="block text-sm font-medium mb-2">Subject</label>
                <select className="w-full rounded-xl border px-4 py-3">
                  <option>General Inquiry</option>
                  <option>Order Support</option>
                  <option>Corporate Gifting</option>
                  <option>Feedback</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium mb-2">Message</label>
                <textarea required rows="4" className="w-full rounded-xl border px-4 py-3" placeholder="Tell us how we can help..."></textarea>
              </div>
              <button className="w-full bg-black text-white rounded-xl py-3 font-medium hover:bg-zinc-800 transition">Send Message</button>
            </form>
          </div>
        </div>
      </div>
    </section>
  );
}

function ChocolateFinder({go}){
  const [step, setStep] = useState(0);
  const [answers, setAnswers] = useState({});
  
  const questions = [
    {q:"What's your chocolate mood?", options:["Adventurous","Classic","Celebratory","Mindful"]},
    {q:"Preferred intensity?", options:["Mild & Creamy","Balanced","Bold & Dark","Extra Intense"]},
    {q:"Texture preference?", options:["Smooth & Silky","Crunchy","Layered","Thin & Crisp"]},
  ];

  const getRecommendation = () => {
    if(answers[0]==="Celebratory") return {collection:"elan",reason:"Perfect for your festive spirit!"};
    if(answers[1]==="Bold & Dark") return {collection:"origins",reason:"For your intense palate!"};
    if(answers[0]==="Mindful") return {collection:"sacred",reason:"Aligned with your values!"};
    return {collection:"regal",reason:"Classic luxury for you!"};
  };

  if(step >= questions.length){
    const rec = getRecommendation();
    return (
      <section className="py-16 bg-white min-h-screen">
        <div className="max-w-2xl mx-auto px-4 text-center">
          <div className="mb-8">
            <div className="w-20 h-20 rounded-full bg-amber-100 mx-auto flex items-center justify-center text-4xl mb-4">🍫</div>
            <h2 className="text-3xl font-light mb-2">Your Perfect Match</h2>
            <p className="text-zinc-600">{rec.reason}</p>
          </div>
          <button onClick={()=>go("collection",rec.collection)} className="bg-black text-white rounded-full px-8 py-4 font-medium hover:bg-zinc-800 transition">Explore Your Collection →</button>
          <button onClick={()=>{setStep(0);setAnswers({});}} className="block mx-auto mt-4 text-sm underline text-zinc-600">Take Quiz Again</button>
        </div>
      </section>
    );
  }

  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-2xl mx-auto px-4">
        <div className="mb-8">
          <div className="flex justify-between text-sm text-zinc-600 mb-2">
            <span>Question {step+1} of {questions.length}</span>
            <span>{Math.round((step/questions.length)*100)}%</span>
          </div>
          <div className="h-2 bg-zinc-200 rounded-full overflow-hidden">
            <div className="h-full bg-black transition-all" style={{width:`${(step/questions.length)*100}%`}}></div>
          </div>
        </div>
        <div className="text-center mb-12">
          <h2 className="text-3xl font-light mb-2">{questions[step].q}</h2>
        </div>
        <div className="grid grid-cols-2 gap-4">
          {questions[step].options.map((opt,i)=>(
            <button key={i} onClick={()=>{setAnswers({...answers,[step]:opt});setStep(step+1);}} className="bg-zinc-50 rounded-2xl p-8 border-2 border-transparent hover:border-black transition text-center">
              <div className="text-lg font-medium">{opt}</div>
            </button>
          ))}
        </div>
      </div>
    </section>
  );
}

function Reviews(){
  const reviews = [
    {name:"Priya Sharma",role:"Mumbai",rating:5,text:"The Regal Collection is absolutely divine. Every piece is a work of art. The quality is unmatched.",date:"Oct 15, 2025"},
    {name:"Arjun Mehta",role:"Bangalore",rating:5,text:"Gifted the Couture Collection to international clients. They were blown away by the craftsmanship.",date:"Oct 10, 2025"},
    {name:"Kavita Desai",role:"Delhi",rating:5,text:"Finally, a chocolate brand that understands luxury. The packaging alone is worth it, but the taste is phenomenal.",date:"Oct 5, 2025"},
    {name:"Rajesh Kumar",role:"Hyderabad",rating:5,text:"The Grand Cru Origins are incredible. You can taste the terroir in every bar. True bean-to-bar excellence.",date:"Sep 28, 2025"},
  ];

  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="text-center mb-12">
          <h2 className="text-3xl font-light mb-2">What Our Patrons Say</h2>
          <div className="flex items-center justify-center gap-2 text-amber-500 text-2xl">
            {"★★★★★"} <span className="text-sm text-zinc-600 ml-2">(4.9/5 from 127 reviews)</span>
          </div>
        </div>
        <div className="space-y-6">
          {reviews.map((r,i)=>(
            <div key={i} className="bg-zinc-50 rounded-3xl p-8 border">
              <div className="flex items-start justify-between mb-4">
                <div>
                  <div className="font-semibold">{r.name}</div>
                  <div className="text-sm text-zinc-600">{r.role}</div>
                </div>
                <div className="text-amber-500">{"★".repeat(r.rating)}</div>
              </div>
              <p className="text-zinc-700 leading-relaxed mb-4">"{r.text}"</p>
              <div className="text-xs text-zinc-500">{r.date}</div>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}

function Subscription(){
  const plans = [
    {name:"Explorer",price:2499,items:"4 bars/month",desc:"Discover new collections every month",features:["Rotating selection","Free shipping","10% discount","Early access"]},
    {name:"Connoisseur",price:4999,items:"8 bars/month",desc:"Premium tasting experience",popular:true,features:["Curated origins","Free shipping","15% discount","Priority access","Exclusive releases"]},
    {name:"Collector",price:9999,items:"16 bars/month",desc:"Complete luxury experience",features:["All collections","Free shipping","20% discount","VIP access","Limited editions","Personal note"]},
  ];

  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="text-center mb-12">
          <h2 className="text-3xl font-light mb-2">The Tasting Club</h2>
          <p className="text-zinc-600">Curated chocolate delivered monthly to your door</p>
        </div>
        <div className="grid md:grid-cols-3 gap-8">
          {plans.map((p,i)=>(
            <div key={i} className={`rounded-3xl p-8 border-2 ${p.popular?'border-black bg-zinc-50':'border-zinc-200'} relative`}>
              {p.popular && <div className="absolute -top-3 left-1/2 -translate-x-1/2 bg-black text-white text-xs px-4 py-1 rounded-full">Most Popular</div>}
              <div className="text-center mb-6">
                <div className="text-2xl font-light mb-2">{p.name}</div>
                <div className="text-4xl font-light mb-1">₹{p.price}</div>
                <div className="text-sm text-zinc-600">{p.items}</div>
              </div>
              <p className="text-center text-zinc-600 text-sm mb-6">{p.desc}</p>
              <ul className="space-y-3 mb-8">
                {p.features.map((f,j)=>(
                  <li key={j} className="flex items-center gap-2 text-sm">
                    <span className="text-green-600">✓</span>
                    <span>{f}</span>
                  </li>
                ))}
              </ul>
              <button className={`w-full rounded-xl py-3 font-medium transition ${p.popular?'bg-black text-white hover:bg-zinc-800':'border-2 border-black hover:bg-black hover:text-white'}`}>Subscribe Now</button>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}

function CorporateGifting(){
  const { corporateContent, loading } = useCorporateGiftingContent();
  
  if (loading) {
    return (
      <div className="py-16 flex justify-center">
        <div className="loading-spinner"></div>
      </div>
    );
  }
  
  const heroSection = corporateContent.find(s => s.section_key === 'hero');
  
  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="text-center mb-12">
          <h2 className="text-3xl font-light mb-2">{heroSection?.title || 'Corporate Gifting'}</h2>
          <p className="text-zinc-600">{heroSection?.description || 'Elevate your business relationships with luxury chocolate'}</p>
        </div>
        <div className="grid md:grid-cols-2 gap-12 mb-16">
          <div className="bg-zinc-50 rounded-3xl p-8 border">
            <h3 className="text-xl font-semibold mb-6">Why Choose LÈVORE for Corporate Gifts?</h3>
            <ul className="space-y-4">
              {heroSection && heroSection.features && Array.isArray(heroSection.features) ? (
                heroSection.features.map((feature, i) => (
                  <li key={i} className="flex items-start gap-3">
                    <span className="text-amber-600 mt-1">✦</span>
                    <div>
                      <div className="font-semibold">{feature.title}</div>
                      <div className="text-sm text-zinc-600">{feature.description}</div>
                    </div>
                  </li>
                ))
              ) : (
                ["Premium packaging with your branding","Minimum order: 25 units","Bulk discounts available","Dedicated account manager","Scheduled delivery","Custom gift messages","Invoice & GST included"].map((item,i)=>(
                  <li key={i} className="flex items-start gap-3">
                    <span className="text-amber-600 mt-1">✦</span>
                    <span className="text-zinc-700">{item}</span>
                  </li>
                ))
              )}
            </ul>
          </div>
          <div className="bg-zinc-50 rounded-3xl p-8 border">
            <h3 className="text-xl font-semibold mb-6">Request a Quote</h3>
            <form className="space-y-4" onSubmit={e=>{e.preventDefault();alert("Thank you! Our corporate team will contact you within 24 hours.");}}>
              <div>
                <label className="block text-sm font-medium mb-2">Company Name</label>
                <input required className="w-full rounded-xl border px-4 py-3"/>
              </div>
              <div>
                <label className="block text-sm font-medium mb-2">Contact Person</label>
                <input required className="w-full rounded-xl border px-4 py-3"/>
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium mb-2">Email</label>
                  <input required type="email" className="w-full rounded-xl border px-4 py-3"/>
                </div>
                <div>
                  <label className="block text-sm font-medium mb-2">Phone</label>
                  <input required className="w-full rounded-xl border px-4 py-3"/>
                </div>
              </div>
              <div>
                <label className="block text-sm font-medium mb-2">Quantity Needed</label>
                <select className="w-full rounded-xl border px-4 py-3">
                  <option>25-50 units</option>
                  <option>50-100 units</option>
                  <option>100-250 units</option>
                  <option>250+ units</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium mb-2">Additional Details</label>
                <textarea rows="3" className="w-full rounded-xl border px-4 py-3" placeholder="Delivery date, customization needs..."></textarea>
              </div>
              <button className="w-full bg-black text-white rounded-xl py-3 font-medium hover:bg-zinc-800 transition">Submit Request</button>
            </form>
          </div>
        </div>
        
        {/* Pricing Tiers */}
        {heroSection && heroSection.pricing_tiers && Array.isArray(heroSection.pricing_tiers) && heroSection.pricing_tiers.length > 0 && (
          <div>
            <h3 className="text-2xl font-light text-center mb-8">Pricing Tiers</h3>
            <div className="grid md:grid-cols-3 gap-6">
              {heroSection.pricing_tiers.map((tier, idx) => (
                <div key={idx} className="bg-zinc-50 rounded-3xl p-8 border">
                  <h4 className="text-xl font-semibold mb-2">{tier.tier}</h4>
                  <div className="text-3xl font-light mb-4">{tier.price_per_unit}</div>
                  <div className="text-sm text-zinc-600 mb-4">Min. order: {tier.min_order} units</div>
                  <ul className="space-y-2 text-sm">
                    {tier.features.map((feature, i) => (
                      <li key={i} className="flex items-start gap-2">
                        <span className="text-green-600">✓</span>
                        <span>{feature}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </section>
  );
}

function Certifications(){
  const { certifications, loading } = useCertifications();
  
  if (loading) {
    return (
      <div className="py-16 flex justify-center">
        <div className="loading-spinner"></div>
      </div>
    );
  }

  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="text-center mb-12">
          <h2 className="text-3xl font-light mb-2">Certifications & Standards</h2>
          <p className="text-zinc-600">Our commitment to quality, safety, and sustainability</p>
        </div>
        
        {certifications.length === 0 ? (
          <div className="text-center py-12">
            <p className="text-zinc-600">Certification information coming soon...</p>
          </div>
        ) : (
          <div className="grid md:grid-cols-3 gap-8 mb-16">
            {certifications.map((cert)=>(
              <div key={cert.id} className="bg-zinc-50 rounded-3xl p-8 border text-center">
                <div className="text-5xl mb-4">{cert.icon_url || '🏅'}</div>
                <h3 className="font-semibold text-lg mb-2">{cert.name}</h3>
                <p className="text-sm text-zinc-600 mb-3">{cert.description}</p>
                {cert.issued_by && (
                  <p className="text-xs text-zinc-500">Issued by: {cert.issued_by}</p>
                )}
              </div>
            ))}
          </div>
        )}
      </div>
    </section>
  );
}
function Blog({go}){
  const { blogPosts, loading } = useBlogPosts();
  
  if (loading) {
    return (
      <div className="py-16 flex justify-center">
        <div className="loading-spinner"></div>
      </div>
    );
  }

  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="text-center mb-12">
          <h2 className="text-3xl font-light mb-2">The LÈVORE Journal</h2>
          <p className="text-zinc-600">Stories of craft, origin, and the art of fine chocolate</p>
        </div>
        
        {blogPosts.length === 0 ? (
          <div className="text-center py-12">
            <p className="text-zinc-600">Blog posts coming soon...</p>
          </div>
        ) : (
          <div className="grid md:grid-cols-3 gap-8">
            {blogPosts.map(post=>(
              <button key={post.id} onClick={()=>go("blog-post",post.slug)} className="group text-left">
                <div className="overflow-hidden rounded-2xl mb-4 aspect-[4/3]">
                  <img src={post.featured_image} alt={post.title} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"/>
                </div>
                <div className="text-xs uppercase tracking-wider text-amber-600 mb-2">{post.category || 'Article'}</div>
                <h3 className="font-semibold text-lg mb-2 group-hover:text-zinc-600 transition">{post.title}</h3>
                <p className="text-sm text-zinc-600 mb-3 line-clamp-2">{post.excerpt}</p>
                <div className="flex items-center justify-between text-xs text-zinc-500">
                  <span>{new Date(post.published_date).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</span>
                  {post.read_time && <span>{post.read_time} min read</span>}
                </div>
              </button>
            ))}
          </div>
        )}
      </div>
    </section>
  );
}

function BlogPost({param}){
  const { blogPost, loading } = useBlogPost(param);
  
  if (loading) {
    return (
      <div className="py-16 flex justify-center">
        <div className="loading-spinner"></div>
      </div>
    );
  }
  
  if (!blogPost) {
    return (
      <section className="py-16 bg-white min-h-screen flex items-center justify-center">
        <div className="text-center">
          <h2 className="text-2xl font-light mb-4">Blog post not found</h2>
          <button onClick={() => window.history.back()} className="text-sm underline">Go Back</button>
        </div>
      </section>
    );
  }

  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        {blogPost.featured_image && (
          <img src={blogPost.featured_image} alt={blogPost.title} className="w-full h-96 object-cover rounded-3xl mb-8"/>
        )}
        <div className="flex items-center gap-4 mb-4">
          <div className="text-xs uppercase tracking-wider text-amber-600">{blogPost.category || 'Article'}</div>
          {blogPost.read_time && <div className="text-xs text-zinc-500">• {blogPost.read_time} min read</div>}
        </div>
        <div className="text-sm text-zinc-500 mb-2">{new Date(blogPost.published_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
        <h1 className="text-4xl font-light mb-2">{blogPost.title}</h1>
        <div className="text-zinc-600 text-lg mb-8">{blogPost.excerpt}</div>
        {blogPost.author && (
          <div className="text-sm text-zinc-500 mb-8">By {blogPost.author}</div>
        )}
        <div className="prose prose-zinc max-w-none">
          {blogPost.content.split('\n\n').map((para,i)=>(
            para.startsWith('#') ? (
              <h2 key={i} className="text-2xl font-semibold mt-8 mb-4">{para.replace(/^#+\s/, '')}</h2>
            ) : (
              <p key={i} className="text-zinc-700 leading-relaxed mb-4">{para}</p>
            )
          ))}
        </div>
        {blogPost.tags && blogPost.tags.length > 0 && (
          <div className="mt-12 pt-8 border-t">
            <div className="flex flex-wrap gap-2">
              {blogPost.tags.map(tag => (
                <span key={tag} className="text-xs px-3 py-1 rounded-full bg-zinc-100 text-zinc-700">#{tag}</span>
              ))}
            </div>
          </div>
        )}
      </div>
    </section>
  );
}

function ProductPage({ product, addToCart, allProducts }) {
  const [qty, setQty] = useState(1);
  const [galleryIndex, setGalleryIndex] = useState(0);
  const [lightboxOpen, setLightboxOpen] = useState(false);

  if (!product) {
    return (
      <section className="py-16 bg-white min-h-screen flex items-center justify-center">
        <div className="text-center">
          <h2 className="text-2xl font-light mb-4">Product not found</h2>
          <button onClick={() => window.history.back()} className="text-sm underline">Go Back</button>
        </div>
      </section>
    );
  }

  const related = allProducts.filter(p => p.collection === product.collection && p.sku !== product.sku).slice(0, 4);
  useEffect(() => {
    function onKey(e) {
      if (e.key === 'ArrowRight') setGalleryIndex(i => (i + 1) % product.imgs.length);
      if (e.key === 'ArrowLeft') setGalleryIndex(i => (i - 1 + product.imgs.length) % product.imgs.length);
      if (e.key === 'Escape' && lightboxOpen) setLightboxOpen(false);
    }
    window.addEventListener('keydown', onKey);
    return () => window.removeEventListener('keydown', onKey);
  }, [product, lightboxOpen]);

  return (
    <section className="py-8 bg-white min-h-screen">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="grid md:grid-cols-2 gap-12">
          <div className="relative">
  <div className="relative mb-4">
    <img onClick={() => setLightboxOpen(true)} src={product.imgs[galleryIndex]} alt={product.name} className="w-full aspect-square object-cover rounded-3xl cursor-zoom-in"/>
  </div>
  <button onClick={() => setGalleryIndex(i => (i - 1 + product.imgs.length) % product.imgs.length)} className="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-16 w-12 h-12 rounded-full bg-white border-2 text-2xl hover:bg-zinc-100 shadow-lg hidden md:flex items-center justify-center">‹</button>
  <button onClick={() => setGalleryIndex(i => (i + 1) % product.imgs.length)} className="absolute right-0 top-1/2 -translate-y-1/2 translate-x-16 w-12 h-12 rounded-full bg-white border-2 text-2xl hover:bg-zinc-100 shadow-lg hidden md:flex items-center justify-center">›</button>
            <div className="grid grid-cols-6 gap-3">
              {product.imgs.map((img, i) => (
                <button key={i} onClick={() => setGalleryIndex(i)} className={`rounded-xl overflow-hidden border-2 ${i === galleryIndex ? 'border-black' : 'border-transparent'} hover:opacity-90`}>
                  <img src={img} alt={`${product.name} ${i}`} className="w-full aspect-square object-cover" />
                </button>
              ))}
            </div>
          </div>

          <div className="space-y-6">
            <div>
              <div className="text-xs uppercase tracking-wider text-zinc-500 mb-2">{product.type} • {product.collectionName}</div>
              <h1 className="text-4xl font-light mb-2">{product.name}</h1>
              <p className="text-zinc-600 leading-relaxed text-lg">{product.blurb}</p>
            </div>

            <div className="flex items-baseline gap-4 pb-6 border-b">
              <div className="text-3xl font-light">₹{product.price}</div>
              <div className="text-zinc-500">{product.pack}{(product.type === "Bars" || product.type === "Hand-Scooped Bar") ? "g" : " pcs"}</div>
            </div>

            <div className="space-y-4">
              <div className="flex items-center gap-4">
  <div className="flex items-center border-2 rounded-xl">
    <button onClick={() => setQty(Math.max(1, qty - 1))} className="px-4 py-2 hover:bg-zinc-50">−</button>
    <div className="px-6 py-2 min-w-[4rem] text-center border-x-2">{qty}</div>
    <button onClick={() => setQty(qty + 1)} className="px-4 py-2 hover:bg-zinc-50">+</button>
  </div>
  <div className="text-zinc-600">Total: ₹{product.price * qty}</div>
</div>

              <div className="grid grid-cols-2 gap-4">
                <button onClick={() => { addToCart(product.sku, qty); alert('Added to cart!'); }} className="rounded-xl bg-white border-2 border-black text-black px-6 py-3 font-medium hover:bg-zinc-50 transition">Add to Cart</button>
                <a href={product.link} target="_blank" rel="noopener noreferrer" className="rounded-xl bg-black text-white px-6 py-3 font-medium text-center hover:bg-zinc-800 transition">Buy Now</a>
              </div>
            </div>

            <div className="space-y-3 pt-6">
              <details open className="group rounded-2xl border bg-zinc-50 overflow-hidden">
                <summary className="px-5 py-4 cursor-pointer font-medium flex items-center justify-between hover:bg-zinc-100"><span>🍫 Ingredients</span><span className="text-xs group-open:rotate-180 transition-transform">▼</span></summary>
                <div className="px-5 pb-4 text-sm text-zinc-600">{product.ingredients || "Cacao mass, sugar, cocoa butter. Clean label craftsmanship."}</div>
              </details>

              <details className="group rounded-2xl border bg-zinc-50 overflow-hidden">
                <summary className="px-5 py-4 cursor-pointer font-medium flex items-center justify-between hover:bg-zinc-100"><span>👅 Tasting Notes</span><span className="text-xs group-open:rotate-180 transition-transform">▼</span></summary>
                <div className="px-5 pb-4"><div className="flex flex-wrap gap-2">{product.type.includes("Dark") && (<><span className="text-xs px-3 py-1 rounded-full bg-amber-100 text-amber-800">Earthy</span><span className="text-xs px-3 py-1 rounded-full bg-red-100 text-red-800">Berry notes</span><span className="text-xs px-3 py-1 rounded-full bg-orange-100 text-orange-800">Citrus hint</span></>)}{product.type.includes("Milk") && (<><span className="text-xs px-3 py-1 rounded-full bg-amber-100 text-amber-800">Creamy</span><span className="text-xs px-3 py-1 rounded-full bg-yellow-100 text-yellow-800">Caramel</span><span className="text-xs px-3 py-1 rounded-full bg-orange-100 text-orange-800">Buttery</span></>)}{(product.type.includes("Nama")||product.type.includes("Bon-bon")) && (<><span className="text-xs px-3 py-1 rounded-full bg-purple-100 text-purple-800">Silky</span><span className="text-xs px-3 py-1 rounded-full bg-pink-100 text-pink-800">Velvety</span></>)}</div></div>
              </details>

              <details className="group rounded-2xl border bg-zinc-50 overflow-hidden">
                <summary className="px-5 py-4 cursor-pointer font-medium flex items-center justify-between hover:bg-zinc-100"><span>☕ Perfect Pairings</span><span className="text-xs group-open:rotate-180 transition-transform">▼</span></summary>
                <div className="px-5 pb-4 text-sm text-zinc-600 space-y-2"><div><strong>Coffee:</strong> Single-origin Ethiopian pour-over</div><div><strong>Tea:</strong> Darjeeling first flush, or Earl Grey</div><div><strong>Wine:</strong> Cabernet Sauvignon or Port</div></div>
              </details>

              <details className="group rounded-2xl border bg-zinc-50 overflow-hidden">
                <summary className="px-5 py-4 cursor-pointer font-medium flex items-center justify-between hover:bg-zinc-100"><span>👨‍🍳 Maker's Note</span><span className="text-xs group-open:rotate-180 transition-transform">▼</span></summary>
                <div className="px-5 pb-4 text-sm text-zinc-600 italic">"{buildNarrative(product)}"</div>
              </details>

              <details className="group rounded-2xl border bg-zinc-50 overflow-hidden">
                <summary className="px-5 py-4 cursor-pointer font-medium flex items-center justify-between hover:bg-zinc-100"><span>🌱 Source & Sustainability</span><span className="text-xs group-open:rotate-180 transition-transform">▼</span></summary>
                <div className="px-5 pb-4 text-sm text-zinc-600"><p className="mb-2">Direct trade with Andhra Pradesh cacao farmers. Fair pricing, transparent relationships.</p><p>100% vegetarian • Palm-oil free • Plastic-neutral packaging</p></div>
              </details>

              <details className="group rounded-2xl border bg-zinc-50 overflow-hidden">
                <summary className="px-5 py-4 cursor-pointer font-medium flex items-center justify-between hover:bg-zinc-100"><span>📦 Storage & Care</span><span className="text-xs group-open:rotate-180 transition-transform">▼</span></summary>
                <div className="px-5 pb-4 text-sm text-zinc-600">Store in a cool, dry place (16-20°C). Best within 6 months. Keep sealed once opened to preserve bloom and snap.</div>
              </details>
            </div>
          </div>
        </div>

        {related.length > 0 && (
          <div className="mt-16 pt-16 border-t">
            <h3 className="text-2xl font-light mb-8">You Might Also Love</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
              {related.map(p => (
                <button key={p.sku} onClick={() => window.location.hash = `#/product/${p.sku}`} className="group text-left">
                  <div className="aspect-square rounded-2xl overflow-hidden mb-3">
                    <img src={p.img} alt={p.name} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                  </div>
                  <div className="font-medium text-sm mb-1">{p.name}</div>
                  <div className="text-xs text-zinc-500 mb-2">{p.collectionName}</div>
                  <div className="font-medium">₹{p.price}</div>
                </button>
              ))}
            </div>
          </div>
        )}
      </div>

      {lightboxOpen && (
        <div className="fixed inset-0 z-[70] bg-black/95 flex items-center justify-center">
          <img src={product.imgs[galleryIndex]} alt={product.name} className="max-w-[90vw] max-h-[90vh] object-contain" />
          <button onClick={() => setLightboxOpen(false)} className="absolute top-6 right-6 w-14 h-14 rounded-full bg-white/90 text-black text-xl hover:bg-white">✕</button>
          <button onClick={() => setGalleryIndex(i => (i - 1 + product.imgs.length) % product.imgs.length)} className="absolute left-6 top-1/2 -translate-y-1/2 w-16 h-16 rounded-full bg-white/90 text-black text-3xl hover:bg-white">‹</button>
          <button onClick={() => setGalleryIndex(i => (i + 1) % product.imgs.length)} className="absolute right-6 top-1/2 -translate-y-1/2 w-16 h-16 rounded-full bg-white/90 text-black text-3xl hover:bg-white">›</button>
        </div>
      )}
    </section>
  );
}    
// Component to display static pages (Privacy, Terms, Shipping, etc.)
function StaticPage({ slug }) {
  const { page, loading, error } = usePage(slug);

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="loading-spinner inline-block w-12 h-12 border-4 border-zinc-300 border-t-black rounded-full"></div>
          <p className="mt-4 text-zinc-600">Loading...</p>
        </div>
      </div>
    );
  }

  if (error || !page) {
    return (
      <div className="min-h-screen flex items-center justify-center px-4">
        <div className="text-center max-w-md">
          <p className="text-red-600 font-semibold mb-2">Page not found</p>
          <p className="text-sm text-zinc-600 mb-4">{error || 'This page could not be loaded.'}</p>
        </div>
      </div>
    );
  }

  return (
    <section className="py-16 bg-white min-h-screen">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div 
          className="prose prose-lg max-w-none prose-headings:font-light prose-headings:text-zinc-900 prose-p:text-zinc-600 prose-a:text-amber-600 prose-a:no-underline hover:prose-a:underline prose-ul:text-zinc-600"
          dangerouslySetInnerHTML={{ __html: page.content }}
        />
      </div>
    </section>
  );
}

function Footer({ go, goAndScroll }){
  return (
    <footer className="bg-zinc-900 text-white py-16 mt-auto">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="grid grid-cols-2 md:grid-cols-5 gap-8 md:gap-12 mb-12">
          <div className="col-span-2 md:col-span-1">
            <div className="font-logo text-3xl mb-4">LÈVORE</div>
            <p className="text-zinc-400 text-sm leading-relaxed mb-6">Couture chocolate, woven in fineness. From Andhra Pradesh to your moment of luxury.</p>
            <div className="flex gap-4">
              <a href="#" className="w-10 h-10 rounded-full border border-zinc-700 flex items-center justify-center hover:border-white transition">
                <span className="sr-only">Instagram</span>
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073z"/><path d="M12 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
              </a>
              <a href="#" className="w-10 h-10 rounded-full border border-zinc-700 flex items-center justify-center hover:border-white transition">
                <span className="sr-only">Facebook</span>
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
              </a>
            </div>
          </div>
          <div>
  <h4 className="font-semibold text-sm uppercase tracking-wider mb-4">Shop</h4>
  <ul className="space-y-3 text-sm text-zinc-400">
    <li><button onClick={()=>goAndScroll("collections")} className="hover:text-white transition">All Collections</button></li>
<li><button onClick={()=>goAndScroll("shop")} className="hover:text-white transition">Shop All</button></li>
<li><button onClick={()=>goAndScroll("gifting")} className="hover:text-white transition">Gifting</button></li>
<li><button onClick={()=>goAndScroll("collection","origins")} className="hover:text-white transition">Grand Cru Origins</button></li>
  </ul>
</div>
          <div>
  <h4 className="font-semibold text-sm uppercase tracking-wider mb-4">About</h4>
  <ul className="space-y-3 text-sm text-zinc-400">
    <li><button onClick={()=>goAndScroll("story")} className="hover:text-white transition">Our Story</button></li>
<li><button onClick={()=>goAndScroll("blog")} className="hover:text-white transition">Journal</button></li>
<li><button onClick={()=>goAndScroll("certifications")} className="hover:text-white transition">Certifications</button></li>
<li><button onClick={()=>goAndScroll("contact")} className="hover:text-white transition">Contact Us</button></li>
  </ul>
</div>
<div>
  <h4 className="font-semibold text-sm uppercase tracking-wider mb-4">Services</h4>
  <ul className="space-y-3 text-sm text-zinc-400">
    <li><button onClick={()=>goAndScroll("account")} className="hover:text-white transition">My Account</button></li>
<li><button onClick={()=>goAndScroll("track-order")} className="hover:text-white transition">Track Order</button></li>
<li><button onClick={()=>goAndScroll("subscription")} className="hover:text-white transition">Tasting Club</button></li>
<li><button onClick={()=>goAndScroll("corporate")} className="hover:text-white transition">Corporate Gifting</button></li>
  </ul>
</div>
          <div className="md:col-span-1">
  <h4 className="font-semibold text-sm uppercase tracking-wider mb-4">Stay Connected</h4>
  <p className="text-sm text-zinc-400 mb-4">Join our tasting list for exclusive releases and craft insights.</p>
            <form onSubmit={(e)=>{e.preventDefault(); const email=new FormData(e.currentTarget).get('email'); location.href=`mailto:hello@levore.in?subject=Tasting%20List&body=Please%20add%20me%20to%20the%20list.%20Email:%20${email}`;}} className="flex flex-col sm:flex-row gap-2">
  <input required name="email" type="email" placeholder="Your email" className="flex-1 rounded-xl bg-zinc-800 border border-zinc-700 px-4 py-3 text-sm text-white placeholder-zinc-500 outline-none focus:border-zinc-500 transition"/>
  <button className="rounded-xl bg-white text-black px-6 py-3 text-sm font-medium hover:bg-zinc-100 transition whitespace-nowrap">Join</button>
</form>
          </div>
        </div>
        <div className="border-t border-zinc-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-zinc-500">
          <div>© {new Date().getFullYear()} LÈVORE. All rights reserved.</div>
          <div className="flex gap-6">
            <button onClick={()=>go("privacy-policy")} className="hover:text-white transition">Privacy Policy</button>
            <button onClick={()=>go("terms-of-service")} className="hover:text-white transition">Terms of Service</button>
            <button onClick={()=>go("shipping-policy")} className="hover:text-white transition">Shipping Policy</button>
          </div>
        </div>
      </div>
    </footer>
  );
}

    function CartDrawer({open, onClose, cart, products, total, onQty, onRemove, onCheckout}){
  const itemCount = cart.length;
  const unitCount = cart.reduce((a,c)=>a+c.qty,0);
  return (<div className={`fixed inset-0 z-[60] ${open?"":"pointer-events-none"}`} aria-hidden={!open}><div onClick={onClose} className={`absolute inset-0 bg-black/30 transition-opacity ${open?"opacity-100":"opacity-0"}`}/><aside className={`absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl transition-transform ${open?"translate-x-0":"translate-x-full"}`}><div className="flex items-center justify-between px-5 h-14 border-b"><div className="font-semibold">Your Cart</div><button onClick={onClose} className="text-sm underline">Close</button></div><div className="px-5 py-4 bg-zinc-50 border-b"><div className="text-sm text-zinc-600">{itemCount} {itemCount===1?'item':'items'} • {unitCount} {unitCount===1?'unit':'units'}</div></div><div className="p-5 space-y-4 overflow-auto h-[calc(100%-56px-68px-80px)]">{cart.length===0 && <p className="text-sm text-zinc-600">Your cart is empty. Add some bars 🍫</p>}{cart.map(line=>{const p = products.find(x=>x.sku===line.sku);if(!p) return null;return (<div key={p.sku} className="flex gap-3 rounded-xl border p-3"><img src={p.img} alt={p.name} className="w-20 h-20 object-cover rounded-lg"/><div className="flex-1"><div className="text-sm font-medium">{p.name}</div><div className="text-xs text-zinc-500 mt-1">₹{p.price} • {p.type}</div><div className="flex items-center gap-2 mt-2"><button onClick={()=>onQty(p.sku,-1)} className="w-7 h-7 rounded border hover:bg-zinc-50">−</button><div className="w-7 text-center text-sm">{line.qty}</div><button onClick={()=>onQty(p.sku,1)} className="w-7 h-7 rounded border hover:bg-zinc-50">+</button><button onClick={()=>onRemove(p.sku)} className="ml-auto text-zinc-400 hover:text-red-600 transition"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></div></div></div>);})}</div><div className="absolute bottom-0 left-0 right-0 border-t bg-white p-5"><div className="flex items-center justify-between text-lg font-semibold mb-4"><span>Total</span><span>₹{total}</span></div><button onClick={onCheckout} disabled={cart.length===0} className={`w-full rounded-xl px-6 py-4 text-sm font-medium uppercase tracking-wider transition ${cart.length===0?'bg-zinc-200 text-zinc-400 cursor-not-allowed':'bg-black text-white hover:bg-zinc-800'}`}>Proceed to Checkout</button></div></aside></div>);
}

function CheckoutDrawer({open, onClose, onBack, cart, products, total, onWhatsApp, onRazorpay, customer, setCustomer}){
  const nameOk = (customer?.name || "").trim().length >= 2;
  const phoneOk = /^[0-9]{10}$/.test((customer?.phone || "").replace(/\D/g,''));
  const addrOk = (customer?.address || "").trim().length >= 10;
  const emailVal = (customer?.email || "").trim();
  const emailOk = !emailVal || /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailVal);
  const formOk = nameOk && phoneOk && addrOk && emailOk;
  function bind(field){
    return { value: customer?.[field] ?? "", onChange: e => setCustomer(prev => ({...prev, [field]: e.target.value})) };
  }
  return (<div className={`fixed inset-0 z-[60] ${open?"":"pointer-events-none"}`} aria-hidden={!open}><div onClick={onClose} className={`absolute inset-0 bg-black/30 transition-opacity ${open?"opacity-100":"opacity-0"}`}/><aside className={`absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl transition-transform ${open?"translate-x-0":"translate-x-full"}`}><div className="flex items-center justify-between px-5 h-14 border-b"><button onClick={onBack} className="flex items-center gap-2 text-sm text-zinc-600 hover:text-black"><span>←</span> Back to Cart</button><button onClick={onClose} className="text-sm underline">Close</button></div><div className="p-5 overflow-auto h-[calc(100%-56px-240px)]"><h3 className="text-xl font-semibold mb-6">Delivery Details</h3><div className="space-y-4"><div><label className="block text-sm font-medium mb-2">Full Name*</label><input className={`w-full rounded-xl border px-4 py-3 text-sm ${!nameOk?'border-red-400':''}`} placeholder="Your full name" {...bind('name')}/></div><div className="grid grid-cols-2 gap-4"><div><label className="block text-sm font-medium mb-2">Phone*</label><input className={`w-full rounded-xl border px-4 py-3 text-sm ${!phoneOk?'border-red-400':''}`} placeholder="10 digits" {...bind('phone')}/></div><div><label className="block text-sm font-medium mb-2">Email</label><input className={`w-full rounded-xl border px-4 py-3 text-sm ${!emailOk?'border-red-400':''}`} placeholder="Optional" {...bind('email')}/></div></div><div><label className="block text-sm font-medium mb-2">Delivery Address*</label><textarea className={`w-full rounded-xl border px-4 py-3 text-sm ${!addrOk?'border-red-400':''}`} rows="3" placeholder="Flat, Street, Area, City, PIN" {...bind('address')}></textarea></div></div></div><div className="absolute bottom-0 left-0 right-0 border-t bg-white p-5 space-y-3"><div className="flex items-center justify-between text-sm mb-4"><span className="text-zinc-600">Order Total</span><span className="text-2xl font-semibold">₹{total}</span></div><div className="grid grid-cols-2 gap-3"><button onClick={onWhatsApp} disabled={!formOk} className={`rounded-xl border px-4 py-3 text-sm font-medium ${formOk?'hover:bg-zinc-50':'opacity-50 cursor-not-allowed'}`}>WhatsApp Order</button><button onClick={formOk ? onRazorpay : undefined} className={`rounded-xl text-white px-4 py-3 text-sm font-medium ${formOk?'bg-black hover:bg-zinc-800':'bg-zinc-300 cursor-not-allowed'}`} title={formOk ? "Pay securely with Razorpay" : "Please fill all required fields"}>Pay with Razorpay</button></div></div></aside></div>);
}


    // MOBILE FIX: Hide initial loader once React successfully mounts
    const hideInitialLoader = () => {
      const loader = document.getElementById('initial-loader');
      if (loader) loader.style.display = 'none';
    };
    
        // Check if React is loaded
    if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
      console.error('React or ReactDOM not loaded');
      document.getElementById('root').innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; flex-direction: column; font-family: system-ui, sans-serif; padding: 20px; text-align: center;">
          <h1 style="font-size: 24px; margin-bottom: 8px;">Scripts failed to load</h1>
          <p style="color: #71717a; margin-bottom: 16px;">Please check your internet connection and try again.</p>
          <button onclick="window.location.reload()" style="background: #000; color: #fff; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">Refresh Page</button>
        </div>
      `;
    } else {
      try {
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
        hideInitialLoader();
        console.log('App initialized successfully');
      } catch (error) {
        console.error('Failed to initialize app:', error);
        document.getElementById('root').innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; flex-direction: column; font-family: system-ui, sans-serif; padding: 20px; text-align: center;">
            <h1 style="font-size: 24px; margin-bottom: 8px;">Unable to load website</h1>
            <p style="color: #71717a; margin-bottom: 16px;">Please try refreshing the page or check your internet connection.</p>
            <button onclick="window.location.reload()" style="background: #000; color: #fff; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">Refresh Page</button>
          </div>
        `;
      }
    }
  </script>
</body>
</html>